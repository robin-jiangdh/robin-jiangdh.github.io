<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T23:19:46.6160286"><meta name="build-number" content="${buildNumber}">       <title>ZooKeeper | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"zookeeper-linktitle-zookeeper-description-zookeeper","level":0,"title":"#ZooKeeper\nlinkTitle: \"ZooKeeper\"\ndescription: \u003e\nZooKeeper","anchor":"#zookeeper-linktitle-zookeeper-description-zookeeper"},{"id":"tools","level":0,"title":"Tools","anchor":"#tools"},{"id":"alternatives-for-zkcli","level":0,"title":"Alternatives for zkCli","anchor":"#alternatives-for-zkcli"},{"id":"web-ui","level":0,"title":"Web UI","anchor":"#web-ui"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="ZooKeeper | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/blog/1.0/kb-zookeeper-index.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="ZooKeeper | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/blog/1.0/kb-zookeeper-index.html#webpage", "url": "/blog/1.0/kb-zookeeper-index.html", "name": "ZooKeeper | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/blog/#website", "url": "/blog/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="kb-zookeeper_index" data-main-title="ZooKeeper" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-setup-and-maintenance///kb-zookeeper"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="kb-zookeeper_index"   id="kb-zookeeper_index.md">ZooKeeper</h1>  <section class="chapter"><h2 id="zookeeper-linktitle-zookeeper-description-zookeeper" data-toc="zookeeper-linktitle-zookeeper-description-zookeeper"   >#ZooKeeper
linkTitle: &quot;ZooKeeper&quot;
description: &gt;
ZooKeeper</h2><section class="chapter"><h3 id="requirements" data-toc="requirements"   >Requirements</h3><p id="5fbc364e_514">TLDR version:</p><ol class="list _decimal" id="5fbc364e_515" type="1"><li class="list__item" id="5fbc364e_516"><p>USE DEDICATED FAST DISKS for the transaction log! (crucial for performance due to write-ahead-log, NVMe is preferred for heavy load setup).</p></li><li class="list__item" id="5fbc364e_517"><p>use 3 nodes (more nodes = slower quorum, less = no HA).</p></li><li class="list__item" id="5fbc364e_518"><p>low network latency between zookeeper nodes is very important (latency, not bandwidth).</p></li><li class="list__item" id="5fbc364e_519"><p>have at least 4Gb of RAM, disable swap, <a href="https://kb.Robinjiang.com/kb-setup-and-maintenance/kb-zookeeper/jvm-sizes-and-garbage-collector-settings/" id="5fbc364e_520"   data-external="true" rel="noopener noreferrer" >tune JVM sizes, and garbage collector settings</a></p></li><li class="list__item" id="5fbc364e_521"><p>ensure that zookeeper will not be CPU-starved by some other processes</p></li><li class="list__item" id="5fbc364e_522"><p><a href="https://kb.Robinjiang.com/kb-setup-and-maintenance/kb-zookeeper/zookeeper-monitoring/" id="5fbc364e_523"   data-external="true" rel="noopener noreferrer" >monitor zookeeper</a>.</p></li></ol><p id="5fbc364e_524">Side note: in many cases, the slowness of the zookeeper is actually a symptom of some issue with clickhouse schema/usage pattern (the most typical issues: an enormous number of partitions/tables/databases with real-time inserts, tiny &amp; frequent inserts).</p></section><section class="chapter"><h3 id="how-to-install" data-toc="how-to-install"   >How to install</h3><ul class="list _ul" id="5fbc364e_525"><li class="list__item" id="5fbc364e_526"><p><a href="https://docs.Robinjiang.com/operationsguide/clickhouse-zookeeper/zookeeper-installation/" id="5fbc364e_527"   data-external="true" rel="noopener noreferrer" >https://docs.Robinjiang.com/operationsguide/clickhouse-zookeeper/zookeeper-installation/</a></p></li><li class="list__item" id="5fbc364e_528"><p><a href="install-ubuntu.html" id="5fbc364e_529" data-tooltip="Tested on Ubuntu 20."  >kb-setup-and-maintenance/kb-zookeeper/install_ubuntu/</a></p></li></ul></section><section class="chapter"><h3 id="random-links-on-best-practices" data-toc="random-links-on-best-practices"   >Random links on best practices</h3><ul class="list _ul" id="5fbc364e_530"><li class="list__item" id="5fbc364e_531"><p><a href="https://docs.confluent.io/platform/current/zookeeper/deployment.html" id="5fbc364e_532"   data-external="true" rel="noopener noreferrer" >https://docs.confluent.io/platform/current/zookeeper/deployment.html</a></p></li><li class="list__item" id="5fbc364e_533"><p><a href="https://zookeeper.apache.org/doc/r3.4.9/zookeeperAdmin.html#sc_commonProblems" id="5fbc364e_534"   data-external="true" rel="noopener noreferrer" >https://zookeeper.apache.org/doc/r3.4.9/zookeeperAdmin.html#sc_commonProblems</a></p></li><li class="list__item" id="5fbc364e_535"><p><a href="https://clickhouse.tech/docs/en/operations/tips/#zookeeper" id="5fbc364e_536"   data-external="true" rel="noopener noreferrer" >https://clickhouse.tech/docs/en/operations/tips/#zookeeper</a></p></li><li class="list__item" id="5fbc364e_537"><p><a href="https://lucene.apache.org/solr/guide/7_4/setting-up-an-external-zookeeper-ensemble.html" id="5fbc364e_538"   data-external="true" rel="noopener noreferrer" >https://lucene.apache.org/solr/guide/7_4/setting-up-an-external-zookeeper-ensemble.html</a></p></li><li class="list__item" id="5fbc364e_539"><p><a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/Troubleshooting" id="5fbc364e_540"   data-external="true" rel="noopener noreferrer" >https://cwiki.apache.org/confluence/display/ZOOKEEPER/Troubleshooting</a></p></li></ul><p id="5fbc364e_541">Cite from <a href="https://zookeeper.apache.org/doc/r3.5.7/zookeeperAdmin.html#sc_commonProblems" id="5fbc364e_542"   data-external="true" rel="noopener noreferrer" >https://zookeeper.apache.org/doc/r3.5.7/zookeeperAdmin.html#sc_commonProblems</a>:</p><aside class="prompt" data-type="tip" data-title="" id="5fbc364e_543"><section class="chapter"><h4 id="things-to-avoid" data-toc="things-to-avoid"   >Things to Avoid</h4><p id="5fbc364e_544">Here are some common problems you can avoid by configuring ZooKeeper correctly:</p><ul class="list _ul" id="5fbc364e_545"><li class="list__item" id="5fbc364e_546"><p><span class="emphasis" id="5fbc364e_547">inconsistent lists of servers</span>: The list of ZooKeeper servers used by the clients must match the list of ZooKeeper servers that each ZooKeeper server has. Things work okay if the client list is a subset of the real list, but things will really act strange if clients have a list of ZooKeeper servers that are in different ZooKeeper clusters. Also, the server lists in each Zookeeper server configuration file should be consistent with one another.</p></li><li class="list__item" id="5fbc364e_548"><p><span class="emphasis" id="5fbc364e_549">incorrect placement of transaction log</span>: The most performance critical part of ZooKeeper is the transaction log. ZooKeeper syncs transactions to media before it returns a response. A dedicated transaction log device is key to consistent good performance. Putting the log on a busy device will adversely affect performance. If you only have one storage device, increase the snapCount so that snapshot files are generated less often; it does not eliminate the problem, but it makes more resources available for the transaction log.</p></li><li class="list__item" id="5fbc364e_550"><p><span class="emphasis" id="5fbc364e_551">incorrect Java heap size</span>: You should take special care to set your Java max heap size correctly. In particular, you should not create a situation in which ZooKeeper swaps to disk. The disk is death to ZooKeeper. Everything is ordered, so if processing one request swaps the disk, all other queued requests will probably do the same. the disk. DON'T SWAP. Be conservative in your estimates: if you have 4G of RAM, do not set the Java max heap size to 6G or even 4G. For example, it is more likely you would use a 3G heap for a 4G machine, as the operating system and the cache also need memory. The best and only recommend practice for estimating the heap size your system needs is to run load tests, and then make sure you are well below the usage limit that would cause the system to swap.</p></li><li class="list__item" id="5fbc364e_552"><p><span class="emphasis" id="5fbc364e_553">Publicly accessible deployment</span>: A ZooKeeper ensemble is expected to operate in a trusted computing environment. It is thus recommended to deploy ZooKeeper behind a firewall.</p></li></ul></section></aside></section><section class="chapter"><h3 id="how-to-check-number-of-followers" data-toc="how-to-check-number-of-followers"   >How to check number of followers:</h3><div class="code-block" data-lang="none"         >
echo mntr | nc zookeeper 2187 | grep foll
zk_synced_followers    2
zk_synced_non_voting_followers    0
zk_avg_follower_sync_time    0.0
zk_min_follower_sync_time    0
zk_max_follower_sync_time    0
zk_cnt_follower_sync_time    0
zk_sum_follower_sync_time    0
</div></section></section><section class="chapter"><h2 id="tools" data-toc="tools"   >Tools</h2><p id="5fbc364e_555"><a href="https://github.com/apache/zookeeper/blob/master/zookeeper-docs/src/main/resources/markdown/zookeeperTools.md" id="5fbc364e_556"   data-external="true" rel="noopener noreferrer" >https://github.com/apache/zookeeper/blob/master/zookeeper-docs/src/main/resources/markdown/zookeeperTools.md</a></p></section><section class="chapter"><h2 id="alternatives-for-zkcli" data-toc="alternatives-for-zkcli"   >Alternatives for zkCli</h2><ul class="list _ul" id="5fbc364e_557"><li class="list__item" id="5fbc364e_558"><p><a href="https://github.com/go-zkcli/zkcli" id="5fbc364e_559"   data-external="true" rel="noopener noreferrer" >https://github.com/go-zkcli/zkcli</a></p></li><li class="list__item" id="5fbc364e_560"><p><a href="https://github.com/outbrain/zookeepercli" id="5fbc364e_561"   data-external="true" rel="noopener noreferrer" >https://github.com/outbrain/zookeepercli</a></p></li><li class="list__item" id="5fbc364e_562"><p><a href="https://idata.co.il/2018/07/a-day-at-the-zoo-graphic-uis-for-apache-zookeeper/" id="5fbc364e_563"   data-external="true" rel="noopener noreferrer" >https://idata.co.il/2018/07/a-day-at-the-zoo-graphic-uis-for-apache-zookeeper/</a></p></li></ul></section><section class="chapter"><h2 id="web-ui" data-toc="web-ui"   >Web UI</h2><ul class="list _ul" id="5fbc364e_564"><li class="list__item" id="5fbc364e_565"><p><a href="https://github.com/elkozmon/zoonavigator-api" id="5fbc364e_566"   data-external="true" rel="noopener noreferrer" >https://github.com/elkozmon/zoonavigator-api</a></p></li><li class="list__item" id="5fbc364e_567"><p><a href="https://github.com/tobilg/docker-zookeeper-webui" id="5fbc364e_568"   data-external="true" rel="noopener noreferrer" >https://github.com/tobilg/docker-zookeeper-webui</a></p></li><li class="list__item" id="5fbc364e_569"><p><a href="https://github.com/vran-dev/PrettyZoo" id="5fbc364e_570"   data-external="true" rel="noopener noreferrer" >https://github.com/vran-dev/PrettyZoo</a></p></li></ul></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="zookeeper-monitoring.html">ZooKeeper Monitoring</a>   <a class="navigation-links__next" href="kb-zookeeper-cluster-migration.html">ZooKeeper cluster migration</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>