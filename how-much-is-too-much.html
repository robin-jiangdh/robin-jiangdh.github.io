<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T22:54:22.3581835"><meta name="build-number" content="${buildNumber}">       <title>How much is too much? | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"how-much-is-too-much-linktitle-how-much-is-too-much-weight-100-description-clickhouse-limitations","level":0,"title":"#How much is too much?\nlinkTitle: \"How much is too much?\"\nweight: 100\ndescription: \u003e-\nClickHouse Limitations.","anchor":"#how-much-is-too-much-linktitle-how-much-is-too-much-weight-100-description-clickhouse-limitations"},{"id":"how-much-is-too-much","level":0,"title":"How much is too much?","anchor":"#how-much-is-too-much"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="How much is too much? | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/1.0/how-much-is-too-much.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="How much is too much? | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/1.0/how-much-is-too-much.html#webpage", "url": "/1.0/how-much-is-too-much.html", "name": "How much is too much? | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="how-much-is-too-much" data-main-title="How much is too much?" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-schema-design"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="how-much-is-too-much"   id="how-much-is-too-much.md">How much is too much?</h1>  <section class="chapter"><h2 id="how-much-is-too-much-linktitle-how-much-is-too-much-weight-100-description-clickhouse-limitations" data-toc="how-much-is-too-much-linktitle-how-much-is-too-much-weight-100-description-clickhouse-limitations"   >#How much is too much?
linkTitle: &quot;How much is too much?&quot;
weight: 100
description: &gt;-
ClickHouse Limitations.</h2></section><section class="chapter"><h2 id="how-much-is-too-much" data-toc="how-much-is-too-much"   >How much is too much?</h2><p id="d2fb1c01_280">In most of the cases clickhouse don't have any hard limits. But obsiously there there are some practical limitation / barriers for different things - often they are caused by some system / network / filesystem limitation.</p><p id="d2fb1c01_281">So after reaching some limits you can get different kind of problems, usually it never a failures / errors, but different kinds of degradations (slower queries / high cpu/memory usage, extra load on the network / zookeeper etc).</p><p id="d2fb1c01_282">While those numbers can vary a lot depending on your hardware &amp; settings there is some safe 'Goldilocks' zone where ClickHouse work the best with default settings &amp; usual hardware.</p><section class="chapter"><h3 id="number-of-tables-system-wide-across-all-databases" data-toc="number-of-tables-system-wide-across-all-databases"   >Number of tables (system-wide, across all databases)</h3><ul class="list _ul" id="d2fb1c01_283"><li class="list__item" id="d2fb1c01_284"><p>non-replicated MergeTree-family tables = few thousands is still acceptable, if you don't do realtime inserts in more that few dozens of them. See <a href="https://github.com/ClickHouse/ClickHouse/issues/32259" id="d2fb1c01_285"   data-external="true" rel="noopener noreferrer" >#32259</a></p></li><li class="list__item" id="d2fb1c01_286"><p>ReplicatedXXXMergeTree = few hundreds is still acceptable, if you don't do realtime inserts in more that few dozens of them. Every Replicated table comes with it's own cost (need to do housekeepeing operations, monitoing replication queues etc). See <a href="https://github.com/ClickHouse/ClickHouse/issues/31919" id="d2fb1c01_287"   data-external="true" rel="noopener noreferrer" >#31919</a></p></li><li class="list__item" id="d2fb1c01_288"><p>Log family table = even dozens of thousands is still ok, especially if database engine = Lazy is used.</p></li></ul></section><section class="chapter"><h3 id="number-of-databases" data-toc="number-of-databases"   >Number of databases</h3><p id="d2fb1c01_289">Fewer than number of tables (above). Dozens / hundreds is usually still acceptable.</p></section><section class="chapter"><h3 id="number-of-inserts-per-seconds" data-toc="number-of-inserts-per-seconds"   >Number of inserts per seconds</h3><p id="d2fb1c01_290">For usual (non async) inserts - dozen is enough. Every insert creates a part, if you will create parts too often, clickhouse will not be able to merge them and you will be getting 'too many parts'.</p></section><section class="chapter"><h3 id="number-of-columns-in-the-table" data-toc="number-of-columns-in-the-table"   >Number of columns in the table</h3><p id="d2fb1c01_291">Up to a few hundreds. With thousands of columns the inserts / background merges may become slower / require more of RAM. See for example https://github.com/ClickHouse/ClickHouse/issues/6943 https://github.com/ClickHouse/ClickHouse/issues/27502</p></section><section class="chapter"><h3 id="clickhouse-instances-on-a-single-node-vm" data-toc="clickhouse-instances-on-a-single-node-vm"   >ClickHouse instances on a single node / VM</h3><p id="d2fb1c01_292">One is enough. Single ClickHouse can use resources of the node very efficiently, and it may require some complicated tuning to run several instances on a single node.</p></section><section class="chapter"><h3 id="number-of-parts-partitions-system-wide-across-all-databases" data-toc="number-of-parts-partitions-system-wide-across-all-databases"   >Number of parts / partitions (system-wide, across all databases)</h3><p id="d2fb1c01_293">More than several dozens thousands may lead to performance degradation: slow starts (see https://github.com/ClickHouse/ClickHouse/issues/10087 ).</p></section><section class="chapter"><h3 id="number-of-tables-partitions-touched-by-a-single-insert" data-toc="number-of-tables-partitions-touched-by-a-single-insert"   >Number of tables &amp; partitions touched by a single insert</h3><p id="d2fb1c01_294">If you have realtime / frequent inserts no more than few.</p><p id="d2fb1c01_295">For the inserts are rare - up to couple of dozens.</p></section><section class="chapter"><h3 id="number-of-parts-in-the-single-table" data-toc="number-of-parts-in-the-single-table"   >Number of parts in the single table</h3><p id="d2fb1c01_296">More than ~ 5 thousands may lead to issues with alters in Replicated tables (caused by <code class="code" id="d2fb1c01_297">jute.maxbuffer</code> overrun, see <a href="zookeeper-session-expired.html" id="d2fb1c01_298" data-tooltip="Q. I get &quot;ZooKeeper session has expired&quot; once. What should i do? Should I worry?"  >details</a>), and query speed degradation.</p></section><section class="chapter"><h3 id="disk-size-per-shard" data-toc="disk-size-per-shard"   >Disk size per shard</h3><p id="d2fb1c01_299">Less than 10TB of compressed data per server. Bigger disk are harder to replace / resync.</p></section><section class="chapter"><h3 id="number-of-shards" data-toc="number-of-shards"   >Number of shards</h3><p id="d2fb1c01_300">Dozens is still ok. More may require having more complex (non-flat) routing.</p></section><section class="chapter"><h3 id="number-of-replicas-in-a-single-shard" data-toc="number-of-replicas-in-a-single-shard"   >Number of replicas in a single shard</h3><p id="d2fb1c01_301">2 is minimum for HA. 3 is a 'golden standard'. Up to 6-8 is still ok. If you have more with realtime inserts - it can impact the zookeeper traffic.</p></section><section class="chapter"><h3 id="number-of-zookeeper-nodes-in-the-ensemble" data-toc="number-of-zookeeper-nodes-in-the-ensemble"   >Number of zookeeper nodes in the ensemble</h3><p id="d2fb1c01_302">3 (Three) for most of the cases is enough (you can loose one node). Using more nodes allows to scale up read throughput for zookeeper, but don't improve writes at all.</p></section><section class="chapter"><h3 id="number-of-materialized-view-attached-to-a-single-table" data-toc="number-of-materialized-view-attached-to-a-single-table"   >Number of materialized view attached to a single table.</h3><p id="d2fb1c01_303">Up to few. The less the better if the table is getting realtime inserts. (no matter if MV are chained or all are feeded from the same source table).</p><p id="d2fb1c01_304">The more you have the more costy your inserts are, and the bigger risks to get some inconsitencies between some MV (inserts to MV and main table are not atomic).</p><p id="d2fb1c01_305">If the table don't have realtime inserts you can have more MV.</p></section><section class="chapter"><h3 id="number-of-projections-inside-a-single-table" data-toc="number-of-projections-inside-a-single-table"   >Number of projections inside a single table.</h3><p id="d2fb1c01_306">Up to few. Similar to MV above.</p></section><section class="chapter"><h3 id="number-of-secondary-indexes-a-single-table" data-toc="number-of-secondary-indexes-a-single-table"   >Number of secondary indexes a single table.</h3><p id="d2fb1c01_307">One to about a dozen. Different types of indexes has different penalty, bloom_filter is 100 times heavier than min_max index At some point your inserts will slow down. Try to create possible minimum of indexes. You can combine many columns into a single index and this index will work for any predicate but create less impact.</p></section><section class="chapter"><h3 id="number-of-kafka-tables-consumers-inside" data-toc="number-of-kafka-tables-consumers-inside"   >Number of Kafka tables / consumers inside</h3><p id="d2fb1c01_308">High number of Kafka tables maybe quite expensive (every consumer = very expensive librdkafka object with several threads inside). Usually alternative approaches are preferrable (mixing several datastreams in one topic, denormalizing, consuming several topics of identical structure with a single Kafka table, etc).</p><p id="d2fb1c01_309">If you really need a lot of Kafka tables you may need more ram / CPU on the node and increase <code class="code" id="d2fb1c01_310">background_message_broker_schedule_pool_size</code> (default is 16) to the number of Kafka tables.</p></section></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="how-to-store-ips.html">IPs/masks</a>   <a class="navigation-links__next" href="floats-vs-decimals.html">Floats vs Decimals</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>