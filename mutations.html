<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T23:19:46.7385214"><meta name="build-number" content="${buildNumber}">       <title>Mutations | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"mutations-linktitle-mutations-description-alter-update-delete","level":0,"title":"#Mutations\nlinkTitle: \"Mutations\"\ndescription: \u003e\nALTER UPDATE / DELETE","anchor":"#mutations-linktitle-mutations-description-alter-update-delete"},{"id":"how-to-know-if-alter-table-delete-update-mutation-on-cluster-was-finished-successfully-on-all-the-nodes","level":0,"title":"How to know if ALTER TABLE … DELETE/UPDATE mutation ON CLUSTER was finished successfully on all the nodes?","anchor":"#how-to-know-if-alter-table-delete-update-mutation-on-cluster-was-finished-successfully-on-all-the-nodes"},{"id":"are-mutations-being-run-in-parallel-or-they-are-sequential-in-clickhouse-in-scope-of-one-table","level":0,"title":"Are mutations being run in parallel or they are sequential in ClickHouse (in scope of one table)","anchor":"#are-mutations-being-run-in-parallel-or-they-are-sequential-in-clickhouse-in-scope-of-one-table"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Mutations | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/blog/1.0/mutations.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Mutations | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/blog/1.0/mutations.html#webpage", "url": "/blog/1.0/mutations.html", "name": "Mutations | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/blog/#website", "url": "/blog/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="mutations" data-main-title="Mutations" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-queries-and-syntax"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="mutations"   id="mutations.md">Mutations</h1>  <section class="chapter"><h2 id="mutations-linktitle-mutations-description-alter-update-delete" data-toc="mutations-linktitle-mutations-description-alter-update-delete"   >#Mutations
linkTitle: &quot;Mutations&quot;
description: &gt;
ALTER UPDATE / DELETE</h2></section><section class="chapter"><h2 id="how-to-know-if-alter-table-delete-update-mutation-on-cluster-was-finished-successfully-on-all-the-nodes" data-toc="how-to-know-if-alter-table-delete-update-mutation-on-cluster-was-finished-successfully-on-all-the-nodes"   >How to know if ALTER TABLE &hellip; DELETE/UPDATE mutation ON CLUSTER was finished successfully on all the nodes?</h2><p id="7914a9d6_121">A. mutation status in system.mutations is local to each replica, so use</p><div class="code-block" data-lang="none"         >
SELECT hostname(), * FROM clusterAllReplicas('your_cluster_name', system.mutations);
-- you can also add WHERE conditions to that query if needed.
</div><p id="7914a9d6_123">Look on <code class="code" id="7914a9d6_124">is_done</code> and <code class="code" id="7914a9d6_125">latest_fail_reason</code> columns</p></section><section class="chapter"><h2 id="are-mutations-being-run-in-parallel-or-they-are-sequential-in-clickhouse-in-scope-of-one-table" data-toc="are-mutations-being-run-in-parallel-or-they-are-sequential-in-clickhouse-in-scope-of-one-table"   >Are mutations being run in parallel or they are sequential in ClickHouse (in scope of one table)</h2><figure  id="7914a9d6_126"><img alt="Mutations" src="images/mutations4.png" title="Mutations"  width="800" height="611"></figure><p id="7914a9d6_127">ClickHouse runs mutations sequentially, but it can combine several mutations in a single and apply all of them in one merge. Sometimes, it can lead to problems, when a combined expression which ClickHouse needs to execute becomes really big. (If ClickHouse combined thousands of mutations in one)</p><p id="7914a9d6_128">Because ClickHouse stores data in independent parts, ClickHouse is able to run mutation(s) merges for each part independently and in parallel. It also can lead to high resource utilization, especially memory usage if you use <code class="code" id="7914a9d6_129">x IN (SELECT ... FROM big_table)</code> statements in mutation, because each merge will run and keep in memory its own HashSet. You can avoid this problem, if you will use <a href="update-via-dictionary.html" id="7914a9d6_130" data-tooltip="In case of Replicated installation, Dictionary should be created on all nodes and source tables should have ReplicatedMergeTree engine and be replicated across all nodes."  >Dictionary approach</a> for such mutations.</p><p id="7914a9d6_131">Parallelism of mutations controlled by settings:</p><div class="code-block" data-lang="none"         >
SELECT *
FROM system.merge_tree_settings
WHERE name LIKE '%mutation%'

┌─name───────────────────────────────────────────────┬─value─┬─changed─┬─description──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬─type───┐
│ max_replicated_mutations_in_queue                  │ 8     │       0 │ How many tasks of mutating parts are allowed simultaneously in ReplicatedMergeTree queue.                                                                                    │ UInt64 │
│ number_of_free_entries_in_pool_to_execute_mutation │ 20    │       0 │ When there is less than specified number of free entries in pool, do not execute part mutations. This is to leave free threads for regular merges and avoid &quot;Too many parts&quot; │ UInt64 │
└────────────────────────────────────────────────────┴───────┴─────────┴──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┘
</div></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="partial-projection-optimization.html">Use both projection and raw data in single query</a>   <a class="navigation-links__next" href="multiple-date-column-in-partition-key.html">Multiple aligned date columns in PARTITION BY expression</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>