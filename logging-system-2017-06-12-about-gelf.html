<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T22:54:22.4704292"><meta name="build-number" content="${buildNumber}">       <title>GELF日志格式漫谈 | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"gelf_1","level":0,"title":"什么是GELF","anchor":"#gelf_1"},{"id":"gelf_2","level":0,"title":"GELF 能解决什么问题","anchor":"#gelf_2"},{"id":"gelf","level":0,"title":"实践中，GELF 存在哪些问题","anchor":"#gelf"},{"id":"gelf-serilog-template","level":0,"title":"GELF+Serilog+template实践","anchor":"#gelf-serilog-template"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="GELF日志格式漫谈 | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/1.0/logging-system-2017-06-12-about-gelf.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="GELF日志格式漫谈 | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/1.0/logging-system-2017-06-12-about-gelf.html#webpage", "url": "/1.0/logging-system-2017-06-12-about-gelf.html", "name": "GELF日志格式漫谈 | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="logging-system_2017-06-12-about-gelf" data-main-title="GELF日志格式漫谈" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="logging-system"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="logging-system_2017-06-12-about-gelf"   id="logging-system_2017-06-12-about-gelf.md">GELF日志格式漫谈</h1>  <section class="chapter"><h2 id="gelf_1" data-toc="gelf_1"   >什么是GELF</h2><p id="4fe1d51e_540">Graylog扩展日志格式（GELF）是一种日志格式。</p><aside class="prompt" data-type="tip" data-title="" id="4fe1d51e_541"><section class="chapter"><h3 id="structured-events-from-anywhere-compressed-and-chunked" data-toc="structured-events-from-anywhere-compressed-and-chunked"   >Structured events from anywhere. Compressed and chunked.</h3><p id="4fe1d51e_542">The Graylog Extended Log Format (GELF) is a log format that avoids the shortcomings of classic plain syslog:</p><ul class="list _ul" id="4fe1d51e_543"><li class="list__item" id="4fe1d51e_544"><p>Limited to length of 1024 bytes &ndash; Not much space for payloads like backtraces</p></li><li class="list__item" id="4fe1d51e_545"><p>No data types in structured syslog. You don&rsquo;t know what is a number and what is a string.</p></li><li class="list__item" id="4fe1d51e_546"><p>The RFCs are strict enough but there are so many syslog dialects out there that you cannot possibly parse all of them.</p></li><li class="list__item" id="4fe1d51e_547"><p>No compression</p></li></ul></section></aside><p id="4fe1d51e_548"><a href="http://docs.graylog.org/en/2.4/pages/gelf.html#gelf-payload-specification" id="4fe1d51e_549"   data-external="true" rel="noopener noreferrer" >GELF 规范</a></p><aside class="prompt" data-type="tip" data-title="" id="4fe1d51e_550"><p id="4fe1d51e_551">A GELF message is a JSON string with the following fields:</p><ul class="list _ul" id="4fe1d51e_552"><li class="list__item" id="4fe1d51e_553"><p id="4fe1d51e_554"><span class="control" id="4fe1d51e_555">version</span> <code class="code" id="4fe1d51e_556">string (UTF-8)</code> &gt; &gt; GELF spec version &ndash; &ldquo;1.1&rdquo;; <span class="control" id="4fe1d51e_557">MUST</span> be set by client library.</p></li><li class="list__item" id="4fe1d51e_558"><p id="4fe1d51e_559"><span class="control" id="4fe1d51e_560">host</span> <code class="code" id="4fe1d51e_561">string (UTF-8)</code> &gt; &gt; the name of the host, source or application that sent this message; <span class="control" id="4fe1d51e_562">MUST</span> be set by client library.</p></li><li class="list__item" id="4fe1d51e_563"><p id="4fe1d51e_564"><span class="control" id="4fe1d51e_565">short_message</span> <code class="code" id="4fe1d51e_566">string (UTF-8)</code> &gt; &gt; a short descriptive message; <span class="control" id="4fe1d51e_567">MUST</span> be set by client library.</p></li><li class="list__item" id="4fe1d51e_568"><p id="4fe1d51e_569"><span class="control" id="4fe1d51e_570">full_message</span> <code class="code" id="4fe1d51e_571">string (UTF-8)</code> &gt; &gt; a long message that can i.e. contain a backtrace; optional.</p></li><li class="list__item" id="4fe1d51e_572"><p id="4fe1d51e_573"><span class="control" id="4fe1d51e_574">timestamp</span> <code class="code" id="4fe1d51e_575">number</code> &gt; &gt; Seconds since UNIX epoch with optional decimal places for milliseconds; <span class="emphasis" id="4fe1d51e_576">SHOULD</span> be set by client library. Will be set to the current timestamp (now) by the server if absent.</p></li><li class="list__item" id="4fe1d51e_577"><p id="4fe1d51e_578"><span class="control" id="4fe1d51e_579">level</span> <code class="code" id="4fe1d51e_580">number</code> &gt; &gt; the level equal to the standard syslog levels; optional, default is 1 (ALERT).</p></li><li class="list__item" id="4fe1d51e_581"><p id="4fe1d51e_582"><span class="control" id="4fe1d51e_583">facility</span> <code class="code" id="4fe1d51e_584">string (UTF-8)</code> &gt; &gt; optional, deprecated. Send as additional field instead.</p></li><li class="list__item" id="4fe1d51e_585"><p id="4fe1d51e_586"><span class="control" id="4fe1d51e_587">line</span> <code class="code" id="4fe1d51e_588">number</code> &gt; &gt; the line in a file that caused the error (decimal); optional, deprecated. Send as additional field instead.</p></li><li class="list__item" id="4fe1d51e_589"><p id="4fe1d51e_590"><span class="control" id="4fe1d51e_591">file</span> <code class="code" id="4fe1d51e_592">string (UTF-8)</code> &gt; &gt; the file (with path if you want) that caused the error (string); optional, deprecated. Send as additional field instead.</p></li><li class="list__item" id="4fe1d51e_593"><p id="4fe1d51e_594"><span class="control" id="4fe1d51e_595">_[additional field]</span> <code class="code" id="4fe1d51e_596">string (UTF-8)</code> or <code class="code" id="4fe1d51e_597">number</code> &gt; &gt; every field you send and prefix with an underscore (<code class="code" id="4fe1d51e_598">_</code>) will be treated as an additional field. Allowed characters in field names are any word character (letter, number, underscore), dashes and dots. The verifying regular expression is: <code class="code" id="4fe1d51e_599">^[\w.-]*$</code>. Libraries SHOULD not allow to send id as additional field (<code class="code" id="4fe1d51e_600">_id</code>). Graylog server nodes omit this field automatically。</p></li></ul></aside></section><section class="chapter"><h2 id="gelf_2" data-toc="gelf_2"   >GELF 能解决什么问题</h2><ul class="list _ul" id="4fe1d51e_601"><li class="list__item" id="4fe1d51e_602"><p>这是个格式规范，能够让绝大部分日志格式相对统一合理，提高日志可读性。</p></li><li class="list__item" id="4fe1d51e_603"><p>这是个json规范，实现比较简单。</p></li><li class="list__item" id="4fe1d51e_604"><p>由于无视源文本类型，对于绝大部分日志工具类能很好支持</p></li></ul></section><section class="chapter"><h2 id="gelf" data-toc="gelf"   >实践中，GELF 存在哪些问题</h2><ul class="list _ul" id="4fe1d51e_605"><li class="list__item" id="4fe1d51e_606"><p id="4fe1d51e_607">这是一个非强制性约束，也就意味着，你需要根据现有业务增加更多的约束条件，比如异常堆栈等标准信息；</p></li><li class="list__item" id="4fe1d51e_608"><p id="4fe1d51e_609">连续日志的追踪需要增加更高级别的支持，类似CorrelationID；</p></li><li class="list__item" id="4fe1d51e_610"><p id="4fe1d51e_611">关于敏感信息过滤问题，假设要实现用户密码字段的过滤，只能通过正则处理生成后的日志文本来过滤，无法前置过滤；</p></li><li class="list__item" id="4fe1d51e_612"><p id="4fe1d51e_613">日志模板问题，大部分日志是依据格式化的模板生成的，类似&ldquo;-: -&rdquo;；日志模板能够极大的降低传输的数据量，很遗憾，这套规范中很难去扩展实现这种模板支持；</p></li><li class="list__item" id="4fe1d51e_614"><p id="4fe1d51e_615">对于Serilog这类提供更多日志信息的库，容易丢失支持的内容</p></li></ul></section><section class="chapter"><h2 id="gelf-serilog-template" data-toc="gelf-serilog-template"   >GELF+Serilog+template实践</h2><p id="4fe1d51e_616">repo近期会迁入github</p></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="logging-system-2018-12-20-how-to-logging-in-production-enviroment.html">生成环境的若干日志实践</a>   <a class="navigation-links__next" href="logging-system-2017-05-10-about-liblog.html">抽象日志组件</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>