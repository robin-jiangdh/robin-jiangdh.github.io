<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T23:19:46.9985088"><meta name="build-number" content="${buildNumber}">       <title>ClickHouse + Spark | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"clickhouse-spark-linktitle-spark-weight-100-description-spark","level":0,"title":"#ClickHouse + Spark\nlinkTitle: \"Spark\"\nweight: 100\ndescription: \u003e-\nSpark","anchor":"#clickhouse-spark-linktitle-spark-weight-100-description-spark"},{"id":"clickhouse-spark","level":0,"title":"ClickHouse + Spark","anchor":"#clickhouse-spark"},{"id":"more-info-some-unordered-links-mostly-in-chinese-russian","level":0,"title":"More info + some unordered links (mostly in Chinese / Russian)","anchor":"#more-info-some-unordered-links-mostly-in-chinese-russian"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="ClickHouse + Spark | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/blog/1.0/spark.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="ClickHouse + Spark | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/blog/1.0/spark.html#webpage", "url": "/blog/1.0/spark.html", "name": "ClickHouse + Spark | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/blog/#website", "url": "/blog/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="Spark" data-main-title="ClickHouse + Spark" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-integrations"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Spark"   id="Spark.md">ClickHouse + Spark</h1>  <section class="chapter"><h2 id="clickhouse-spark-linktitle-spark-weight-100-description-spark" data-toc="clickhouse-spark-linktitle-spark-weight-100-description-spark"   >#ClickHouse + Spark
linkTitle: &quot;Spark&quot;
weight: 100
description: &gt;-
Spark</h2></section><section class="chapter"><h2 id="clickhouse-spark" data-toc="clickhouse-spark"   >ClickHouse + Spark</h2><section class="chapter"><h3 id="jdbc" data-toc="jdbc"   >jdbc</h3><p id="a4d1286f_452">The trivial &amp; natural way to talk to ClickHouse from Spark is using jdbc. There are 2 jdbc drivers:</p><ul class="list _ul" id="a4d1286f_453"><li class="list__item" id="a4d1286f_454"><p>https://github.com/ClickHouse/clickhouse-jdbc/</p></li><li class="list__item" id="a4d1286f_455"><p>https://github.com/housepower/ClickHouse-Native-JDBC#integration-with-spark</p></li></ul><p id="a4d1286f_456">ClickHouse-Native-JDBC has some hints about integration with Spark even in the main README file.</p><p id="a4d1286f_457">'Official' driver does support some conversion of complex data types (Roarring bitmaps) for Spark-Clickhouse integration: https://github.com/ClickHouse/clickhouse-jdbc/pull/596</p><p id="a4d1286f_458">But proper partitioning of the data (to spark partitions) may be tricky with jdbc.</p><p id="a4d1286f_459">Some example snippets:</p><ul class="list _ul" id="a4d1286f_460"><li class="list__item" id="a4d1286f_461"><p>https://markelic.de/how-to-access-your-clickhouse-database-with-spark-in-python/</p></li><li class="list__item" id="a4d1286f_462"><p>https://stackoverflow.com/questions/60448877/how-can-i-write-spark-dataframe-to-clickhouse</p></li></ul></section><section class="chapter"><h3 id="connectors" data-toc="connectors"   >Connectors</h3><ul class="list _ul" id="a4d1286f_463"><li class="list__item" id="a4d1286f_464"><p>https://github.com/DmitryBe/spark-clickhouse (looks dead)</p></li><li class="list__item" id="a4d1286f_465"><p>https://github.com/VaBezruchko/spark-clickhouse-connector (is not actively maintained).</p></li><li class="list__item" id="a4d1286f_466"><p>https://github.com/housepower/spark-clickhouse-connector (actively developing connector from housepower - same guys as authors of ClickHouse-Native-JDBC)</p></li></ul></section><section class="chapter"><h3 id="via-kafka" data-toc="via-kafka"   >via Kafka</h3><p id="a4d1286f_467">ClickHouse can produce / consume data from/to Kafka to exchange data with Spark.</p></section><section class="chapter"><h3 id="via-hdfs" data-toc="via-hdfs"   >via hdfs</h3><p id="a4d1286f_468">You can load data into hadoop/hdfs using sequence of statements like <code class="code" id="a4d1286f_469">INSERT INTO FUNCTION hdfs(...) SELECT ... FROM clickhouse_table</code> later process the data from hdfs by spark and do the same in reverse direction.</p></section><section class="chapter"><h3 id="via-s3" data-toc="via-s3"   >via s3</h3><p id="a4d1286f_470">Similar to above but using s3.</p></section><section class="chapter"><h3 id="via-shell-calls" data-toc="via-shell-calls"   >via shell calls</h3><p id="a4d1286f_471">You can call other commands from Spark. Those commands can be <code class="code" id="a4d1286f_472">clickhouse-client</code> and/or <code class="code" id="a4d1286f_473">clickhouse-local</code>.</p></section><section class="chapter"><h3 id="do-you-really-need-spark" data-toc="do-you-really-need-spark"   >do you really need Spark? :)</h3><p id="a4d1286f_474">In many cases you can do everything inside ClickHouse without Spark help :) Arrays, Higher-order functions, machine learning, integration with lot of different things including the possibility to run some external code using executable dictionaries or UDF.</p></section></section><section class="chapter"><h2 id="more-info-some-unordered-links-mostly-in-chinese-russian" data-toc="more-info-some-unordered-links-mostly-in-chinese-russian"   >More info + some unordered links (mostly in Chinese / Russian)</h2><ul class="list _ul" id="a4d1286f_475"><li class="list__item" id="a4d1286f_476"><p>Spark + ClickHouse: not a fight, but a symbiosis https://github.com/ClickHouse/clickhouse-presentations/blob/master/meetup28/spark_and_clickhouse.pdf (russian)</p></li><li class="list__item" id="a4d1286f_477"><p>Using a bunch of ClickHouse and Spark in MFI Soft https://www.youtube.com/watch?v=ID8eTnmag0s (russian)</p></li><li class="list__item" id="a4d1286f_478"><p>Spark read and write ClickHouse https://yerias.github.io/2020/12/08/clickhouse</p></li><li class="list__item" id="a4d1286f_479"><p>Spark reads and writes ClickHouse through jdbc https://blog.katastros.com/a?ID=01800-e40e1b3c-5fa4-4ea0-a3a8-f5e89ef0ce14</p></li><li class="list__item" id="a4d1286f_480"><p>Spark JDBC write clickhouse operation summary https://www.jianshu.com/p/43f78c8a025b?hmsr=toutiao.io&amp;utm_campaign=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io https://toutiao.io/posts/m63yw89/preview</p></li><li class="list__item" id="a4d1286f_481"><p>Spark-sql is based on Clickhouse's DataSourceV2 data source extension (russian) https://www.cnblogs.com/mengyao/p/4689866.html</p></li><li class="list__item" id="a4d1286f_482"><p>Alibaba integration instructions https://www.alibabacloud.com/help/doc-detail/191192.htm</p></li><li class="list__item" id="a4d1286f_483"><p>Tencent integration instructions https://intl.cloud.tencent.com/document/product/1026/35884</p></li><li class="list__item" id="a4d1286f_484"><p>Yandex DataProc demo: loading files from S3 to ClickHouse with Spark https://www.youtube.com/watch?v=N3bZW0_rRzI</p></li><li class="list__item" id="a4d1286f_485"><p>Clickhouse official documentation_Spark JDBC writes some pits of ClickHouse https://blog.csdn.net/weixin_39615984/article/details/111206050</p></li><li class="list__item" id="a4d1286f_486"><p>ClickHouse data import (Flink, Spark, Kafka, MySQL, Hive) https://zhuanlan.zhihu.com/p/299094269</p></li><li class="list__item" id="a4d1286f_487"><p>Baifendian Big Data Technical Team: Practice of ClickHouse data synchronization solutionbased on multiple Spark tasks. https://www.6aiq.com/article/1635461873075</p></li><li class="list__item" id="a4d1286f_488"><p>SPARK-CLICKHOUSE-ES REAL-TIME PROJECT EIGHTH DAY-PRECISE ONE-TIME CONSUMPTION SAVE OFFSET. https://www.freesion.com/article/71421322524/</p></li><li class="list__item" id="a4d1286f_489"><p>Still struggling with real-time data warehouse selection, Spark + ClickHouse makes yoamazing! https://dbaplus.cn/news-73-3806-1.html</p></li><li class="list__item" id="a4d1286f_490"><p>HDFS+ClickHouse+Spark: A lightweight big data analysis system from 0 to 1. https://juejin.cn/post/6850418114962653198</p></li><li class="list__item" id="a4d1286f_491"><p>ClickHouse Clustering for Spark Developer http://blog.madhukaraphatak.com/clickouse-clustering-spark-developer/</p></li><li class="list__item" id="a4d1286f_492"><p>&laquo;Иногда приходится заглядывать в код Spark&raquo;: Александр Морозов (SEMrush) об использовании Scala, Spark и ClickHouse. https://habr.com/ru/company/jugru/blog/341288/</p></li></ul></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="array-like-memory-usage.html">arrayMap, arrayJoin or ARRAY JOIN memory usage</a>   <a class="navigation-links__next" href="mysql-clickhouse.html">MySQL</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>