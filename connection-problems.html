<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T23:19:47.213402"><meta name="build-number" content="${buildNumber}">       <title>Can not connect to my ClickHouse server | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"can-not-connect-to-my-clickhouse-server-linktitle-can-not-connect-to-my-clickhouse-server-weight-100-description-can-not-connect-to-my-clickhouse-server","level":0,"title":"#Can not connect to my ClickHouse server\nlinkTitle: \"Can not connect to my ClickHouse server\"\nweight: 100\ndescription: \u003e-\nCan not connect to my ClickHouse server.","anchor":"#can-not-connect-to-my-clickhouse-server-linktitle-can-not-connect-to-my-clickhouse-server-weight-100-description-can-not-connect-to-my-clickhouse-server"},{"id":"can-not-connect-to-my-clickhouse-server","level":0,"title":"Can not connect to my ClickHouse server","anchor":"#can-not-connect-to-my-clickhouse-server"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Can not connect to my ClickHouse server | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/blog/1.0/connection-problems.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Can not connect to my ClickHouse server | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/blog/1.0/connection-problems.html#webpage", "url": "/blog/1.0/connection-problems.html", "name": "Can not connect to my ClickHouse server | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/blog/#website", "url": "/blog/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="connection-problems" data-main-title="Can not connect to my ClickHouse server" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-setup-and-maintenance"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="connection-problems"   id="connection-problems.md">Can not connect to my ClickHouse server</h1>  <section class="chapter"><h2 id="can-not-connect-to-my-clickhouse-server-linktitle-can-not-connect-to-my-clickhouse-server-weight-100-description-can-not-connect-to-my-clickhouse-server" data-toc="can-not-connect-to-my-clickhouse-server-linktitle-can-not-connect-to-my-clickhouse-server-weight-100-description-can-not-connect-to-my-clickhouse-server"   >#Can not connect to my ClickHouse server
linkTitle: &quot;Can not connect to my ClickHouse server&quot;
weight: 100
description: &gt;-
Can not connect to my ClickHouse server.</h2></section><section class="chapter"><h2 id="can-not-connect-to-my-clickhouse-server" data-toc="can-not-connect-to-my-clickhouse-server"   >Can not connect to my ClickHouse server</h2><p id="af7ca9b2_334">Errors like &quot;Connection reset by peer, while reading from socket&quot;</p><ol class="list _decimal" id="af7ca9b2_335" type="1"><li class="list__item" id="af7ca9b2_336"><p id="af7ca9b2_337">Ensure that the clickhouse-server is running</p><div class="code-block" data-lang="none"         >
systemctl status clickhouse-server
</div><p id="af7ca9b2_339">If server was restarted recently and don't accept the connections after the restart - most probably it still just starting. During the startup sequence it need to iterate over all data folders in /var/lib/clickhouse-server In case if you have a very high number of folders there (usually caused by a wrong partitioning, or a very high number of tables / databases) that startup time can take a lot of time (same can happen if disk is very slow, for example NFS).</p><p id="af7ca9b2_340">You can check that by looking for 'Ready for connections' line in <code class="code" id="af7ca9b2_341">/var/log/clickhouse-server/clickhouse-server.log</code> (<code class="code" id="af7ca9b2_342">Information</code> log level neede)</p></li><li class="list__item" id="af7ca9b2_343"><p id="af7ca9b2_344">Ensure you use the proper port ip / interface?</p><p id="af7ca9b2_345">Ensure you're not trying to connect to secure port without tls / https or vice versa.</p><p id="af7ca9b2_346">For clickhouse-client - pay attention on host / port / secure flags.</p><p id="af7ca9b2_347">Ensure the interface you're connecting to is the one which clickhouse listens (by default clickhouse listens only localhost).</p><p id="af7ca9b2_348">Note: If you uncomment line <code class="code" id="af7ca9b2_349">&lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;</code> only - clickhouse will listen only ipv4 interfaces, while the localhost (used by clickhouse-client) may be resolved to ipv6 address. And clickhouse-client may be failing to connect.</p><p id="af7ca9b2_350">How to check which interfaces / ports do clickhouse listen?</p><div class="code-block" data-lang="none"         >
sudo lsof -i -P -n | grep LISTEN

echo listen_host
sudo clickhouse-extract-from-config --config=/etc/clickhouse-server/config.xml --key=listen_host
echo tcp_port
sudo clickhouse-extract-from-config --config=/etc/clickhouse-server/config.xml --key=tcp_port
echo tcp_port_secure
sudo clickhouse-extract-from-config --config=/etc/clickhouse-server/config.xml --key=tcp_port_secure
echo http_port
sudo clickhouse-extract-from-config --config=/etc/clickhouse-server/config.xml --key=http_port
echo https_port
sudo clickhouse-extract-from-config --config=/etc/clickhouse-server/config.xml --key=https_port
</div></li><li class="list__item" id="af7ca9b2_352"><p id="af7ca9b2_353">For secure connection:</p><ul class="list _ul" id="af7ca9b2_354"><li class="list__item" id="af7ca9b2_355"><p>ensure that server uses some certificate which can be validated by the client</p></li><li class="list__item" id="af7ca9b2_356"><p>OR disable certificate checks on the client (UNSECURE)</p></li></ul></li><li class="list__item" id="af7ca9b2_357"><p id="af7ca9b2_358">Check for errors in /var/log/clickhouse-server/clickhouse-server.err.log ?</p></li><li class="list__item" id="af7ca9b2_359"><p id="af7ca9b2_360">Is clickhouse able to serve some trivial tcp / http requests from localhost?</p><div class="code-block" data-lang="none"         >
curl 127.0.0.1:9200
curl 127.0.0.1:8123
</div></li><li class="list__item" id="af7ca9b2_362"><p id="af7ca9b2_363">Check number of sockets opened by clickhouse</p><div class="code-block" data-lang="none"         >
sudo lsof -i -a -p $(pidof clickhouse-server)

# or (adjust 9000 / 8123 ports if needed)
netstat -tn 2&gt;/dev/null | tail -n +3 | awk '{ printf(&quot;%s\t%s\t%s\t%s\t%s\t%s\n&quot;, $1, $2, $3, $4, $5, $6) }' | clickhouse-local -S &quot;Proto String, RecvQ Int64, SendQ Int64, LocalAddress String, ForeignAddress String, State LowCardinality(String)&quot; --query=&quot;SELECT * FROM table WHERE LocalAddress like '%:9000' FORMAT PrettyCompact&quot;

netstat -tn 2&gt;/dev/null | tail -n +3 | awk '{ printf(&quot;%s\t%s\t%s\t%s\t%s\t%s\n&quot;, $1, $2, $3, $4, $5, $6) }' | clickhouse-local -S &quot;Proto String, RecvQ Int64, SendQ Int64, LocalAddress String, ForeignAddress String, State LowCardinality(String)&quot; --query=&quot;SELECT * FROM table WHERE LocalAddress like '%:8123' FORMAT PrettyCompact&quot;
</div><p id="af7ca9b2_365">ClickHouse has a limit of number of open connections (4000 by default).</p></li><li class="list__item" id="af7ca9b2_366"><p id="af7ca9b2_367">Check also:</p><div class="code-block" data-lang="none"         >
# system overall support limited number of connections it can handle
netstat

# you can also be reaching of of the process ulimits (Max open files)
cat /proc/$(pidof -s clickhouse-server)/limits
</div></li><li class="list__item" id="af7ca9b2_369"><p id="af7ca9b2_370">Check firewall / selinux rules (if used)</p></li></ol></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="custom-settings.html">Custom Settings</a>   <a class="navigation-links__next" href="clickhouse-versions.html">ClickHouse versions</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>