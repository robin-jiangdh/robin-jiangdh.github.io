<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T22:54:23.4808028"><meta name="build-number" content="${buildNumber}">       <title>clickhouse-copier | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"clickhouse-copier-linktitle-clickhouse-copier-description-clickhouse-copier","level":0,"title":"#clickhouse-copier\nlinkTitle: \"clickhouse-copier\"\ndescription: \u003e\nclickhouse-copier","anchor":"#clickhouse-copier-linktitle-clickhouse-copier-description-clickhouse-copier"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="clickhouse-copier | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/1.0/kb-clickhouse-copier-index.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="clickhouse-copier | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/1.0/kb-clickhouse-copier-index.html#webpage", "url": "/1.0/kb-clickhouse-copier-index.html", "name": "clickhouse-copier | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="kb-clickhouse-copier_index" data-main-title="clickhouse-copier" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-setup-and-maintenance///kb-data-migration///kb-clickhouse-copier"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="kb-clickhouse-copier_index"   id="kb-clickhouse-copier_index.md">clickhouse-copier</h1>  <section class="chapter"><h2 id="clickhouse-copier-linktitle-clickhouse-copier-description-clickhouse-copier" data-toc="clickhouse-copier-linktitle-clickhouse-copier-description-clickhouse-copier"   >#clickhouse-copier
linkTitle: &quot;clickhouse-copier&quot;
description: &gt;
clickhouse-copier</h2><p id="97647191_260">The description of the utility and its parameters, as well as examples of the config files that you need to create for the copier are in the official doc <a href="https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/" id="97647191_261"   data-external="true" rel="noopener noreferrer" >ClickHouse copier utility</a></p><p id="97647191_262">The steps to run a task:</p><ol class="list _decimal" id="97647191_263" type="1"><li class="list__item" id="97647191_264"><p id="97647191_265">Create a config file for clickhouse-copier (zookeeper.xml)</p><p id="97647191_266"><a href="https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/#format-of-zookeeper-xml" id="97647191_267"   data-external="true" rel="noopener noreferrer" >ZooKeeper config format</a></p></li><li class="list__item" id="97647191_268"><p id="97647191_269">Create a config file for the task (task1.xml)</p><p id="97647191_270"><a href="https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/#configuration-of-copying-tasks" id="97647191_271"   data-external="true" rel="noopener noreferrer" >Copy task configuration</a></p></li><li class="list__item" id="97647191_272"><p id="97647191_273">Create the task in ZooKeeper and start an instance of clickhouse-copier</p><p id="97647191_274"><code class="code" id="97647191_275">clickhouse-copier --daemon --base-dir=/opt/clickhouse-copier --config=/opt/clickhouse-copier/zookeeper.xml --task-path=/clickhouse/copier/task1 --task-file=/opt/clickhouse-copier/task1.xml</code></p><p id="97647191_276">If the node in ZooKeeper already exists and you want to change it, you need to add the <code class="code" id="97647191_277">task-upload-force</code> parameter:</p><p id="97647191_278"><code class="code" id="97647191_279">clickhouse-copier --daemon --base-dir=/opt/clickhouse-copier --config=/opt/clickhouse-copier/zookeeper.xml --task-path=/clickhouse/copier/task1 --task-file=/opt/clickhouse-copier/task1.xml --task-upload-force=1</code></p><p id="97647191_280">If you want to run another instance of clickhouse-copier for the same task, you need to copy the config file (zookeeper.xml) to another server, and run this command:</p><p id="97647191_281"><code class="code" id="97647191_282">clickhouse-copier --daemon --base-dir=/opt/clickhouse-copier --config=/opt/clickhouse-copier/zookeeper.xml --task-path=/clickhouse/copier/task1</code></p></li></ol><p id="97647191_283">The number of simultaneously running instances is controlled be the <code class="code" id="97647191_284">max_workers</code> parameter in your task configuration file. If you run more workers superfluous workers will sleep and log messages like this:</p><p id="97647191_285"><code class="code" id="97647191_286">&lt;Debug&gt; ClusterCopier: Too many workers (1, maximum 1). Postpone processing</code></p><section class="chapter"><h3 id="see-also" data-toc="see-also"   >See also</h3><ul class="list _ul" id="97647191_287"><li class="list__item" id="97647191_288"><p>https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/</p></li><li class="list__item" id="97647191_289"><p>Никита Михайлов. Кластер ClickHouse ctrl-с ctrl-v. HighLoad++ Весна 2021 <a href="https://raw.githubusercontent.com/ClickHouse/clickhouse-presentations/master/highload2021/copier.pdf" id="97647191_290"   data-external="true" rel="noopener noreferrer" >slides</a></p></li><li class="list__item" id="97647191_291"><p>21.7 have a huge bulk of fixes / improvements. https://github.com/ClickHouse/ClickHouse/pull/23518</p></li><li class="list__item" id="97647191_292"><p>https://Robinjiang.com/blog/2018/8/22/clickhouse-copier-in-practice</p></li><li class="list__item" id="97647191_293"><p>http://www.clickhouse.com.cn/topic/601fb322b06e5e0f21ba79e1</p></li><li class="list__item" id="97647191_294"><p>https://github.com/getsentry/snuba/blob/master/docs/clickhouse-copier.md</p></li><li class="list__item" id="97647191_295"><p>https://hughsite.com/post/clickhouse-copier-usage.html</p></li><li class="list__item" id="97647191_296"><p>https://www.jianshu.com/p/c058edd664a6</p></li></ul></section></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="kubernetes-job.html">Kubernetes job for clickhouse-copier</a>   <a class="navigation-links__next" href="20-4-21-6.html">clickhouse-copier 20.4 - 21.6</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>