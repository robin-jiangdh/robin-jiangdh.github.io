<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T22:54:23.021074"><meta name="build-number" content="${buildNumber}">       <title>Network Configuration | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"network-configuration-linktitle-network-configuration-description-network-configuration","level":0,"title":"#Network Configuration\nlinkTitle: \"Network Configuration\"\ndescription: \u003e\nNetwork Configuration","anchor":"#network-configuration-linktitle-network-configuration-description-network-configuration"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Network Configuration | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/1.0/network-configuration.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Network Configuration | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/1.0/network-configuration.html#webpage", "url": "/1.0/network-configuration.html", "name": "Network Configuration | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="network-configuration" data-main-title="Network Configuration" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-setup-and-maintenance///cluster-production-configuration-guide"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="network-configuration"   id="network-configuration.md">Network Configuration</h1>  <section class="chapter"><h2 id="network-configuration-linktitle-network-configuration-description-network-configuration" data-toc="network-configuration-linktitle-network-configuration-description-network-configuration"   >#Network Configuration
linkTitle: &quot;Network Configuration&quot;
description: &gt;
Network Configuration</h2><section class="chapter"><h3 id="networking-and-server-room-planning" data-toc="networking-and-server-room-planning"   >Networking And Server Room Planning</h3><p id="93014a75_799">The network used for your ClickHouse cluster should be a fast network, ideally 10 Gbit or more. ClickHouse nodes generate a lot of traffic to exchange the data between nodes (port 9009 for replication, and 9000 for distributed queries). Zookeeper traffic in normal circumstanses is moderate, but in some special cases can also be very significant.</p><p id="93014a75_800">For the zookeeper low latency is more important than bandwidth.</p><p id="93014a75_801">Keep the replicas isolated on the hardware level. This allows for cluster failover from possible outages.</p><ul class="list _ul" id="93014a75_802"><li class="list__item" id="93014a75_803"><p>For Physical Environments: Avoid placing 2 ClickHouse replicas on the same server rack. Ideally, they should be on isolated network switches and an isolated power supply.</p></li><li class="list__item" id="93014a75_804"><p>For Clouds Environments: Use different availability zones between the ClickHouse replicas when possible (but be aware of the interzone traffic costs)</p></li></ul><p id="93014a75_805">These considerations are the same as the Zookeeper nodes.</p><p id="93014a75_806">For example:</p><div class="table-wrapper"><table class="wide" id="93014a75_807"><thead><tr class="ijRowHead" id="93014a75_808"><th id="93014a75_809"><p><span class="control" id="93014a75_810">Rack</span></p></th><th id="93014a75_811"><p><span class="control" id="93014a75_812">Server</span></p></th><th id="93014a75_813"><p><span class="control" id="93014a75_814">Server</span></p></th><th id="93014a75_815"><p><span class="control" id="93014a75_816">Server</span></p></th><th id="93014a75_817"><p><span class="control" id="93014a75_818">Server</span></p></th></tr></thead><tbody><tr id="93014a75_819"><td id="93014a75_820"><p><span class="control" id="93014a75_821">Rack 1</span></p></td><td id="93014a75_822"><p><span class="control" id="93014a75_823">CH_SHARD1_R1</span></p></td><td id="93014a75_824"><p><span class="control" id="93014a75_825">CH_SHARD2_R1</span></p></td><td id="93014a75_826"><p><span class="control" id="93014a75_827">CH_SHARD3_R1</span></p></td><td id="93014a75_828"><p><span class="control" id="93014a75_829">ZOO_1</span></p></td></tr><tr id="93014a75_830"><td id="93014a75_831"><p><span class="control" id="93014a75_832">Rack 2</span></p></td><td id="93014a75_833"><p><span class="control" id="93014a75_834">CH_SHARD1_R2</span></p></td><td id="93014a75_835"><p><span class="control" id="93014a75_836">CH_SHARD2_R2</span></p></td><td id="93014a75_837"><p><span class="control" id="93014a75_838">CH_SHARD3_R2</span></p></td><td id="93014a75_839"><p><span class="control" id="93014a75_840">ZOO_2</span></p></td></tr><tr id="93014a75_841"><td id="93014a75_842"><p><span class="control" id="93014a75_843">Rack 3</span></p></td><td id="93014a75_844"><p><span class="control" id="93014a75_845">ZOO3</span></p></td><td id="93014a75_846"></td><td id="93014a75_847"></td><td id="93014a75_848"></td></tr></tbody></table></div><section class="chapter"><h4 id="network-ports-and-firewall" data-toc="network-ports-and-firewall"   >Network Ports And Firewall</h4><p id="93014a75_849">ClickHouse listens the following ports:</p><ul class="list _ul" id="93014a75_850"><li class="list__item" id="93014a75_851"><p>9000: clickhouse-client, native clients, other clickhouse-servers connect to here.</p></li><li class="list__item" id="93014a75_852"><p>8123: HTTP clients</p></li><li class="list__item" id="93014a75_853"><p>9009: Other replicas will connect here to download data.</p></li></ul><p id="93014a75_854">For more information, see <a href="https://www.Robinjiang.com/blog/2019/3/15/clickhouse-networking-part-1" id="93014a75_855"   data-external="true" rel="noopener noreferrer" >CLICKHOUSE NETWORKING, PART 1</a>.</p><p id="93014a75_856">Zookeeper listens the following ports:</p><ul class="list _ul" id="93014a75_857"><li class="list__item" id="93014a75_858"><p>2181: Client connections.</p></li><li class="list__item" id="93014a75_859"><p>2888: Inter-ensemble connections.</p></li><li class="list__item" id="93014a75_860"><p>3888: Leader election.</p></li></ul><p id="93014a75_861">Outbound traffic from ClickHouse connects to the following ports:</p><ul class="list _ul" id="93014a75_862"><li class="list__item" id="93014a75_863"><p>ZooKeeper: On port 2181.</p></li><li class="list__item" id="93014a75_864"><p>Other CH nodes in the cluster: On port 9000 and 9009.</p></li><li class="list__item" id="93014a75_865"><p>Dictionary sources: Depending on what was configured such as HTTP, MySQL, Mongo, etc.</p></li><li class="list__item" id="93014a75_866"><p>Kafka or Hadoop: If those integrations were enabled.</p></li></ul></section></section><section class="chapter"><h3 id="ssl" data-toc="ssl"   >SSL</h3><p id="93014a75_867">For non-trusted networks enable SSL/HTTPS. If acceptable, it is better to keep interserver communications unencrypted for performance reasons.</p></section><section class="chapter"><h3 id="naming-schema" data-toc="naming-schema"   >Naming Schema</h3><p id="93014a75_868">The best time to start creating a naming schema for the servers is before they&rsquo;re created and configured.</p><p id="93014a75_869">There are a few features based on good server naming in ClickHouse:</p><ul class="list _ul" id="93014a75_870"><li class="list__item" id="93014a75_871"><p>clickhouse-client prompts: Allows a different prompt for clickhouse-client per server hostname.</p></li><li class="list__item" id="93014a75_872"><p>Nearest hostname load balancing: For more information, see <a href="https://clickhouse.yandex/docs/en/operations/settings/settings/#load_balancing-nearest_hostname" id="93014a75_873"   data-external="true" rel="noopener noreferrer" >Nearest Hostname</a>.</p></li></ul><p id="93014a75_874">A good option is to use the following:</p><p id="93014a75_875">----.</p><p id="93014a75_876">Other examples:</p><ul class="list _ul" id="93014a75_877"><li class="list__item" id="93014a75_878"><p>rxv-olap-ch-master-sh01-r01: </p><ul class="list _ul" id="93014a75_879"><li class="list__item" id="93014a75_880"><p>rxv - location (rack#15)</p></li><li class="list__item" id="93014a75_881"><p>olap - product name</p></li><li class="list__item" id="93014a75_882"><p>ch = clickhouse</p></li><li class="list__item" id="93014a75_883"><p>master = stage</p></li><li class="list__item" id="93014a75_884"><p>sh01 = shard 1</p></li><li class="list__item" id="93014a75_885"><p>r01 = replica 1</p></li></ul></li><li class="list__item" id="93014a75_886"><p>hetnzerde1-ch-prod-01.local: </p><ul class="list _ul" id="93014a75_887"><li class="list__item" id="93014a75_888"><p>hetnzerde1 - location (also replica id)</p></li><li class="list__item" id="93014a75_889"><p>ch = clickhouse</p></li><li class="list__item" id="93014a75_890"><p>prod = stage</p></li><li class="list__item" id="93014a75_891"><p>01 - server number / shard number in that DC</p></li></ul></li><li class="list__item" id="93014a75_892"><p>sh01.ch-front.dev.aws-east1a.example.com: </p><ul class="list _ul" id="93014a75_893"><li class="list__item" id="93014a75_894"><p>sh01 - shard 01</p></li><li class="list__item" id="93014a75_895"><p>ch-front - cluster name</p></li><li class="list__item" id="93014a75_896"><p>dev = stage</p></li><li class="list__item" id="93014a75_897"><p>aws = cloud provider</p></li><li class="list__item" id="93014a75_898"><p>east1a = region and availability zone</p></li></ul></li></ul><section class="chapter"><h4 id="host-name-references" data-toc="host-name-references"   >Host Name References</h4><ul class="list _ul" id="93014a75_899"><li class="list__item" id="93014a75_900"><p><a href="https://stackoverflow.com/a/39336460/1555175" id="93014a75_901"   data-external="true" rel="noopener noreferrer" >What are the best practices for domain names (dev, staging, production)?</a></p></li><li class="list__item" id="93014a75_902"><p><a href="https://www.replex.io/blog/9-best-practices-and-examples-for-working-with-kubernetes-labels" id="93014a75_903"   data-external="true" rel="noopener noreferrer" >9 Best Practices and Examples for Working with Kubernetes Labels</a></p></li><li class="list__item" id="93014a75_904"><p><a href="https://devcentral.f5.com/s/articles/thoughts-on-hostname-nomenclature" id="93014a75_905"   data-external="true" rel="noopener noreferrer" >Thoughts On Hostname Nomenclature</a></p></li></ul></section></section><section class="chapter"><h3 id="additional-hostname-tips" data-toc="additional-hostname-tips"   >Additional Hostname Tips</h3><ul class="list _ul" id="93014a75_906"><li class="list__item" id="93014a75_907"><p>Hostnames configured on the server should not change. If you do need to change the host name, one reference to use is <a href="https://linuxize.com/post/how-to-change-hostname-on-ubuntu-18-04/" id="93014a75_908"   data-external="true" rel="noopener noreferrer" >How to Change Hostname on Ubuntu 18.04</a>.</p></li><li class="list__item" id="93014a75_909"><p>The server should be accessible to other servers in the cluster via it&rsquo;s hostname. Otherwise you will need to configure interserver_hostname in your config.</p></li><li class="list__item" id="93014a75_910"><p>Ensure that <code class="code" id="93014a75_911">hostname --fqdn</code> and <code class="code" id="93014a75_912">getent hosts $(hostname --fqdn)</code> return the correct name and ip.</p></li></ul></section></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="version-upgrades.html">Version Upgrades</a>   <a class="navigation-links__next" href="hardware-requirements.html">Hardware Requirements</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>