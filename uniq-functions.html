<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T23:19:46.6220409"><meta name="build-number" content="${buildNumber}">       <title>Functions to count uniqs | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs","level":0,"title":"#Functions to count uniqs\nlinkTitle: \"Functions to count uniqs\"\nweight: 100\ndescription: \u003e-\nFunctions to count uniqs.","anchor":"#functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs"},{"id":"functions-to-count-uniqs","level":0,"title":"Functions to count uniqs","anchor":"#functions-to-count-uniqs"},{"id":"groupbitmap","level":0,"title":"groupBitmap","anchor":"#groupbitmap"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Functions to count uniqs | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/blog/1.0/uniq-functions.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Functions to count uniqs | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/blog/1.0/uniq-functions.html#webpage", "url": "/blog/1.0/uniq-functions.html", "name": "Functions to count uniqs | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/blog/#website", "url": "/blog/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="uniq-functions" data-main-title="Functions to count uniqs" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-schema-design"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="uniq-functions"   id="uniq-functions.md">Functions to count uniqs</h1>  <section class="chapter"><h2 id="functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs" data-toc="functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs"   >#Functions to count uniqs
linkTitle: &quot;Functions to count uniqs&quot;
weight: 100
description: &gt;-
Functions to count uniqs.</h2></section><section class="chapter"><h2 id="functions-to-count-uniqs" data-toc="functions-to-count-uniqs"   >Functions to count uniqs</h2><div class="table-wrapper"><table class="wide" id="1b9dea37_887"><thead><tr class="ijRowHead" id="1b9dea37_888"><th id="1b9dea37_889"><p>Function</p></th><th id="1b9dea37_890"><p>Function(State)</p></th><th id="1b9dea37_891"><p>StateSize</p></th><th id="1b9dea37_892"><p>Result</p></th><th id="1b9dea37_893"><p>QPS</p></th></tr></thead><tbody><tr id="1b9dea37_894"><td id="1b9dea37_895"><p>uniqExact</p></td><td id="1b9dea37_896"><p>uniqExactState</p></td><td id="1b9dea37_897"><p>1600003</p></td><td id="1b9dea37_898"><p>100000</p></td><td id="1b9dea37_899"><p>59.23</p></td></tr><tr id="1b9dea37_900"><td id="1b9dea37_901"><p>uniq</p></td><td id="1b9dea37_902"><p>uniqState</p></td><td id="1b9dea37_903"><p>200804</p></td><td id="1b9dea37_904"><p>100315</p></td><td id="1b9dea37_905"><p>85.55</p></td></tr><tr id="1b9dea37_906"><td id="1b9dea37_907"><p>uniqCombined</p></td><td id="1b9dea37_908"><p>uniqCombinedState</p></td><td id="1b9dea37_909"><p>98505</p></td><td id="1b9dea37_910"><p>100314</p></td><td id="1b9dea37_911"><p>108.09</p></td></tr><tr id="1b9dea37_912"><td id="1b9dea37_913"><p>uniqCombined(12)</p></td><td id="1b9dea37_914"><p>uniqCombinedState(12)</p></td><td id="1b9dea37_915"><p>3291</p></td><td id="1b9dea37_916"><p>98160</p></td><td id="1b9dea37_917"><p>151.64</p></td></tr><tr id="1b9dea37_918"><td id="1b9dea37_919"><p>uniqCombined(15)</p></td><td id="1b9dea37_920"><p>uniqCombinedState(15)</p></td><td id="1b9dea37_921"><p>24783</p></td><td id="1b9dea37_922"><p>100768</p></td><td id="1b9dea37_923"><p>110.18</p></td></tr><tr id="1b9dea37_924"><td id="1b9dea37_925"><p>uniqCombined(18)</p></td><td id="1b9dea37_926"><p>uniqCombinedState(18)</p></td><td id="1b9dea37_927"><p>196805</p></td><td id="1b9dea37_928"><p>100332</p></td><td id="1b9dea37_929"><p>101.56</p></td></tr><tr id="1b9dea37_930"><td id="1b9dea37_931"><p>uniqCombined(20)</p></td><td id="1b9dea37_932"><p>uniqCombinedState(20)</p></td><td id="1b9dea37_933"><p>786621</p></td><td id="1b9dea37_934"><p>100088</p></td><td id="1b9dea37_935"><p>65.05</p></td></tr><tr id="1b9dea37_936"><td id="1b9dea37_937"><p>uniqCombined64(12)</p></td><td id="1b9dea37_938"><p>uniqCombined64State(12)</p></td><td id="1b9dea37_939"><p>3291</p></td><td id="1b9dea37_940"><p>98160</p></td><td id="1b9dea37_941"><p>164.96</p></td></tr><tr id="1b9dea37_942"><td id="1b9dea37_943"><p>uniqCombined64(15)</p></td><td id="1b9dea37_944"><p>uniqCombined64State(15)</p></td><td id="1b9dea37_945"><p>24783</p></td><td id="1b9dea37_946"><p>100768</p></td><td id="1b9dea37_947"><p>133.96</p></td></tr><tr id="1b9dea37_948"><td id="1b9dea37_949"><p>uniqCombined64(18)</p></td><td id="1b9dea37_950"><p>uniqCombined64State(18)</p></td><td id="1b9dea37_951"><p>196805</p></td><td id="1b9dea37_952"><p>100332</p></td><td id="1b9dea37_953"><p>110.85</p></td></tr><tr id="1b9dea37_954"><td id="1b9dea37_955"><p>uniqCombined64(20)</p></td><td id="1b9dea37_956"><p>uniqCombined64State(20)</p></td><td id="1b9dea37_957"><p>786621</p></td><td id="1b9dea37_958"><p>100088</p></td><td id="1b9dea37_959"><p>66.48</p></td></tr><tr id="1b9dea37_960"><td id="1b9dea37_961"><p>uniqHLL12</p></td><td id="1b9dea37_962"><p>uniqHLL12State</p></td><td id="1b9dea37_963"><p>2651</p></td><td id="1b9dea37_964"><p>101344</p></td><td id="1b9dea37_965"><p>177.91</p></td></tr><tr id="1b9dea37_966"><td id="1b9dea37_967"><p>uniqTheta</p></td><td id="1b9dea37_968"><p>uniqThetaState</p></td><td id="1b9dea37_969"><p>32795</p></td><td id="1b9dea37_970"><p>98045</p></td><td id="1b9dea37_971"><p>144.05</p></td></tr><tr id="1b9dea37_972"><td id="1b9dea37_973"><p>uniqUpTo(100)</p></td><td id="1b9dea37_974"><p>uniqUpToState(100)</p></td><td id="1b9dea37_975"><p>1</p></td><td id="1b9dea37_976"><p>101</p></td><td id="1b9dea37_977"><p>222.93</p></td></tr></tbody></table></div><p id="1b9dea37_978">Stats collected via script below on 22.2</p><div class="code-block" data-lang="none"         >
funcname=( &quot;uniqExact&quot; &quot;uniq&quot; &quot;uniqCombined&quot; &quot;uniqCombined(12)&quot; &quot;uniqCombined(15)&quot; &quot;uniqCombined(18)&quot; &quot;uniqCombined(20)&quot; &quot;uniqCombined64(12)&quot; &quot;uniqCombined64(15)&quot; &quot;uniqCombined64(18)&quot; &quot;uniqCombined64(20)&quot; &quot;uniqHLL12&quot; &quot;uniqTheta&quot; &quot;uniqUpTo(100)&quot;)
funcname2=( &quot;uniqExactState&quot; &quot;uniqState&quot; &quot;uniqCombinedState&quot; &quot;uniqCombinedState(12)&quot; &quot;uniqCombinedState(15)&quot; &quot;uniqCombinedState(18)&quot; &quot;uniqCombinedState(20)&quot; &quot;uniqCombined64State(12)&quot; &quot;uniqCombined64State(15)&quot; &quot;uniqCombined64State(18)&quot; &quot;uniqCombined64State(20)&quot; &quot;uniqHLL12State&quot; &quot;uniqThetaState&quot; &quot;uniqUpToState(100)&quot;)

length=${#funcname[@]}
 

for (( j=0; j&lt;length; j++ ));
do
  f1=&quot;${funcname[$j]}&quot;
  f2=&quot;${funcname2[$j]}&quot;
  size=$( clickhouse-client -q &quot;select ${f2}(toString(number)) from numbers_mt(100000) FORMAT RowBinary&quot; | wc -c )
  result=&quot;$( clickhouse-client -q &quot;select ${f1}(toString(number)) from numbers_mt(100000)&quot; )&quot;
  time=$( rm /tmp/clickhouse-benchmark.json; echo &quot;select ${f1}(toString(number)) from numbers_mt(100000)&quot; | clickhouse-benchmark -i200 --json=/tmp/clickhouse-benchmark.json &amp;&gt;/dev/null; cat /tmp/clickhouse-benchmark.json | grep QPS  )

  printf &quot;|%s|%s,%s,%s,%s\n&quot; &quot;$f1&quot; &quot;$f2&quot; &quot;$size&quot; &quot;$result&quot; &quot;$time&quot;
done
</div></section><section class="chapter"><h2 id="groupbitmap" data-toc="groupbitmap"   >groupBitmap</h2><p id="1b9dea37_980">Use <a href="https://roaringbitmap.org/" id="1b9dea37_981"   data-external="true" rel="noopener noreferrer" >Roaring Bitmaps</a> underneat. Return amount of uniq values.</p><p id="1b9dea37_982">Can be used with Int* types Works really great when your values quite similar. (Low memory usage / state size)</p><p id="1b9dea37_983">Example with blockchain data, block_number is monotonically increasing number.</p><div class="code-block" data-lang="none"         >
SELECT groupBitmap(block_number) FROM blockchain;

┌─groupBitmap(block_number)─┐
│                  48478157 │
└───────────────────────────┘

MemoryTracker: Peak memory usage (for query): 64.44 MiB.
1 row in set. Elapsed: 32.044 sec. Processed 4.77 billion rows, 38.14 GB (148.77 million rows/s., 1.19 GB/s.)

SELECT uniqExact(block_number) FROM blockchain;

┌─uniqExact(block_number)─┐
│                48478157 │
└─────────────────────────┘

MemoryTracker: Peak memory usage (for query): 4.27 GiB.
1 row in set. Elapsed: 70.058 sec. Processed 4.77 billion rows, 38.14 GB (68.05 million rows/s., 544.38 MB/s.)
</div></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="modify-ttl.html">MODIFY (ADD) TTL</a>   <a class="navigation-links__next" href="row-level-deduplication.html">ClickHouse row-level deduplication</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>