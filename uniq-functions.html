<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T22:54:22.0788571"><meta name="build-number" content="${buildNumber}">       <title>Functions to count uniqs | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs","level":0,"title":"#Functions to count uniqs\nlinkTitle: \"Functions to count uniqs\"\nweight: 100\ndescription: \u003e-\nFunctions to count uniqs.","anchor":"#functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs"},{"id":"functions-to-count-uniqs","level":0,"title":"Functions to count uniqs","anchor":"#functions-to-count-uniqs"},{"id":"groupbitmap","level":0,"title":"groupBitmap","anchor":"#groupbitmap"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Functions to count uniqs | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/1.0/uniq-functions.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Functions to count uniqs | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/1.0/uniq-functions.html#webpage", "url": "/1.0/uniq-functions.html", "name": "Functions to count uniqs | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="uniq-functions" data-main-title="Functions to count uniqs" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-schema-design"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="uniq-functions"   id="uniq-functions.md">Functions to count uniqs</h1>  <section class="chapter"><h2 id="functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs" data-toc="functions-to-count-uniqs-linktitle-functions-to-count-uniqs-weight-100-description-functions-to-count-uniqs"   >#Functions to count uniqs
linkTitle: &quot;Functions to count uniqs&quot;
weight: 100
description: &gt;-
Functions to count uniqs.</h2></section><section class="chapter"><h2 id="functions-to-count-uniqs" data-toc="functions-to-count-uniqs"   >Functions to count uniqs</h2><div class="table-wrapper"><table class="wide" id="1b9dea37_691"><thead><tr class="ijRowHead" id="1b9dea37_692"><th id="1b9dea37_693"><p>Function</p></th><th id="1b9dea37_694"><p>Function(State)</p></th><th id="1b9dea37_695"><p>StateSize</p></th><th id="1b9dea37_696"><p>Result</p></th><th id="1b9dea37_697"><p>QPS</p></th></tr></thead><tbody><tr id="1b9dea37_698"><td id="1b9dea37_699"><p>uniqExact</p></td><td id="1b9dea37_700"><p>uniqExactState</p></td><td id="1b9dea37_701"><p>1600003</p></td><td id="1b9dea37_702"><p>100000</p></td><td id="1b9dea37_703"><p>59.23</p></td></tr><tr id="1b9dea37_704"><td id="1b9dea37_705"><p>uniq</p></td><td id="1b9dea37_706"><p>uniqState</p></td><td id="1b9dea37_707"><p>200804</p></td><td id="1b9dea37_708"><p>100315</p></td><td id="1b9dea37_709"><p>85.55</p></td></tr><tr id="1b9dea37_710"><td id="1b9dea37_711"><p>uniqCombined</p></td><td id="1b9dea37_712"><p>uniqCombinedState</p></td><td id="1b9dea37_713"><p>98505</p></td><td id="1b9dea37_714"><p>100314</p></td><td id="1b9dea37_715"><p>108.09</p></td></tr><tr id="1b9dea37_716"><td id="1b9dea37_717"><p>uniqCombined(12)</p></td><td id="1b9dea37_718"><p>uniqCombinedState(12)</p></td><td id="1b9dea37_719"><p>3291</p></td><td id="1b9dea37_720"><p>98160</p></td><td id="1b9dea37_721"><p>151.64</p></td></tr><tr id="1b9dea37_722"><td id="1b9dea37_723"><p>uniqCombined(15)</p></td><td id="1b9dea37_724"><p>uniqCombinedState(15)</p></td><td id="1b9dea37_725"><p>24783</p></td><td id="1b9dea37_726"><p>100768</p></td><td id="1b9dea37_727"><p>110.18</p></td></tr><tr id="1b9dea37_728"><td id="1b9dea37_729"><p>uniqCombined(18)</p></td><td id="1b9dea37_730"><p>uniqCombinedState(18)</p></td><td id="1b9dea37_731"><p>196805</p></td><td id="1b9dea37_732"><p>100332</p></td><td id="1b9dea37_733"><p>101.56</p></td></tr><tr id="1b9dea37_734"><td id="1b9dea37_735"><p>uniqCombined(20)</p></td><td id="1b9dea37_736"><p>uniqCombinedState(20)</p></td><td id="1b9dea37_737"><p>786621</p></td><td id="1b9dea37_738"><p>100088</p></td><td id="1b9dea37_739"><p>65.05</p></td></tr><tr id="1b9dea37_740"><td id="1b9dea37_741"><p>uniqCombined64(12)</p></td><td id="1b9dea37_742"><p>uniqCombined64State(12)</p></td><td id="1b9dea37_743"><p>3291</p></td><td id="1b9dea37_744"><p>98160</p></td><td id="1b9dea37_745"><p>164.96</p></td></tr><tr id="1b9dea37_746"><td id="1b9dea37_747"><p>uniqCombined64(15)</p></td><td id="1b9dea37_748"><p>uniqCombined64State(15)</p></td><td id="1b9dea37_749"><p>24783</p></td><td id="1b9dea37_750"><p>100768</p></td><td id="1b9dea37_751"><p>133.96</p></td></tr><tr id="1b9dea37_752"><td id="1b9dea37_753"><p>uniqCombined64(18)</p></td><td id="1b9dea37_754"><p>uniqCombined64State(18)</p></td><td id="1b9dea37_755"><p>196805</p></td><td id="1b9dea37_756"><p>100332</p></td><td id="1b9dea37_757"><p>110.85</p></td></tr><tr id="1b9dea37_758"><td id="1b9dea37_759"><p>uniqCombined64(20)</p></td><td id="1b9dea37_760"><p>uniqCombined64State(20)</p></td><td id="1b9dea37_761"><p>786621</p></td><td id="1b9dea37_762"><p>100088</p></td><td id="1b9dea37_763"><p>66.48</p></td></tr><tr id="1b9dea37_764"><td id="1b9dea37_765"><p>uniqHLL12</p></td><td id="1b9dea37_766"><p>uniqHLL12State</p></td><td id="1b9dea37_767"><p>2651</p></td><td id="1b9dea37_768"><p>101344</p></td><td id="1b9dea37_769"><p>177.91</p></td></tr><tr id="1b9dea37_770"><td id="1b9dea37_771"><p>uniqTheta</p></td><td id="1b9dea37_772"><p>uniqThetaState</p></td><td id="1b9dea37_773"><p>32795</p></td><td id="1b9dea37_774"><p>98045</p></td><td id="1b9dea37_775"><p>144.05</p></td></tr><tr id="1b9dea37_776"><td id="1b9dea37_777"><p>uniqUpTo(100)</p></td><td id="1b9dea37_778"><p>uniqUpToState(100)</p></td><td id="1b9dea37_779"><p>1</p></td><td id="1b9dea37_780"><p>101</p></td><td id="1b9dea37_781"><p>222.93</p></td></tr></tbody></table></div><p id="1b9dea37_782">Stats collected via script below on 22.2</p><div class="code-block" data-lang="none"         >
funcname=( &quot;uniqExact&quot; &quot;uniq&quot; &quot;uniqCombined&quot; &quot;uniqCombined(12)&quot; &quot;uniqCombined(15)&quot; &quot;uniqCombined(18)&quot; &quot;uniqCombined(20)&quot; &quot;uniqCombined64(12)&quot; &quot;uniqCombined64(15)&quot; &quot;uniqCombined64(18)&quot; &quot;uniqCombined64(20)&quot; &quot;uniqHLL12&quot; &quot;uniqTheta&quot; &quot;uniqUpTo(100)&quot;)
funcname2=( &quot;uniqExactState&quot; &quot;uniqState&quot; &quot;uniqCombinedState&quot; &quot;uniqCombinedState(12)&quot; &quot;uniqCombinedState(15)&quot; &quot;uniqCombinedState(18)&quot; &quot;uniqCombinedState(20)&quot; &quot;uniqCombined64State(12)&quot; &quot;uniqCombined64State(15)&quot; &quot;uniqCombined64State(18)&quot; &quot;uniqCombined64State(20)&quot; &quot;uniqHLL12State&quot; &quot;uniqThetaState&quot; &quot;uniqUpToState(100)&quot;)

length=${#funcname[@]}
 

for (( j=0; j&lt;length; j++ ));
do
  f1=&quot;${funcname[$j]}&quot;
  f2=&quot;${funcname2[$j]}&quot;
  size=$( clickhouse-client -q &quot;select ${f2}(toString(number)) from numbers_mt(100000) FORMAT RowBinary&quot; | wc -c )
  result=&quot;$( clickhouse-client -q &quot;select ${f1}(toString(number)) from numbers_mt(100000)&quot; )&quot;
  time=$( rm /tmp/clickhouse-benchmark.json; echo &quot;select ${f1}(toString(number)) from numbers_mt(100000)&quot; | clickhouse-benchmark -i200 --json=/tmp/clickhouse-benchmark.json &amp;&gt;/dev/null; cat /tmp/clickhouse-benchmark.json | grep QPS  )

  printf &quot;|%s|%s,%s,%s,%s\n&quot; &quot;$f1&quot; &quot;$f2&quot; &quot;$size&quot; &quot;$result&quot; &quot;$time&quot;
done
</div></section><section class="chapter"><h2 id="groupbitmap" data-toc="groupbitmap"   >groupBitmap</h2><p id="1b9dea37_784">Use <a href="https://roaringbitmap.org/" id="1b9dea37_785"   data-external="true" rel="noopener noreferrer" >Roaring Bitmaps</a> underneat. Return amount of uniq values.</p><p id="1b9dea37_786">Can be used with Int* types Works really great when your values quite similar. (Low memory usage / state size)</p><p id="1b9dea37_787">Example with blockchain data, block_number is monotonically increasing number.</p><div class="code-block" data-lang="none"         >
SELECT groupBitmap(block_number) FROM blockchain;

┌─groupBitmap(block_number)─┐
│                  48478157 │
└───────────────────────────┘

MemoryTracker: Peak memory usage (for query): 64.44 MiB.
1 row in set. Elapsed: 32.044 sec. Processed 4.77 billion rows, 38.14 GB (148.77 million rows/s., 1.19 GB/s.)

SELECT uniqExact(block_number) FROM blockchain;

┌─uniqExact(block_number)─┐
│                48478157 │
└─────────────────────────┘

MemoryTracker: Peak memory usage (for query): 4.27 GiB.
1 row in set. Elapsed: 70.058 sec. Processed 4.77 billion rows, 38.14 GB (68.05 million rows/s., 544.38 MB/s.)
</div></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="modify-ttl.html">MODIFY (ADD) TTL</a>   <a class="navigation-links__next" href="row-level-deduplication.html">ClickHouse row-level deduplication</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>