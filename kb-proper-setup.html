<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T22:54:22.0638459"><meta name="build-number" content="${buildNumber}">       <title>Proper setup | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"proper-setup-linktitle-proper-setup-description-proper-setup","level":0,"title":"#Proper setup\nlinkTitle: \"Proper setup\"\ndescription: \u003e\nProper setup","anchor":"#proper-setup-linktitle-proper-setup-description-proper-setup"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Proper setup | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/1.0/kb-proper-setup.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Proper setup | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/1.0/kb-proper-setup.html#webpage", "url": "/1.0/kb-proper-setup.html", "name": "Proper setup | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="kb-proper-setup" data-main-title="Proper setup" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-setup-and-maintenance///kb-zookeeper"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="kb-proper-setup"   id="kb-proper-setup.md">Proper setup</h1>  <section class="chapter"><h2 id="proper-setup-linktitle-proper-setup-description-proper-setup" data-toc="proper-setup-linktitle-proper-setup-description-proper-setup"   >#Proper setup
linkTitle: &quot;Proper setup&quot;
description: &gt;
Proper setup</h2><section class="chapter"><h3 id="main-docs-article" data-toc="main-docs-article"   >Main docs article</h3><p id="24f90123_253"><a href="https://docs.Robinjiang.com/operationsguide/clickhouse-zookeeper/zookeeper-installation/" id="24f90123_254"   data-external="true" rel="noopener noreferrer" >https://docs.Robinjiang.com/operationsguide/clickhouse-zookeeper/zookeeper-installation/</a></p></section><section class="chapter"><h3 id="hardware-requirements" data-toc="hardware-requirements"   >Hardware requirements</h3><p id="24f90123_255">TLDR version:</p><ol class="list _decimal" id="24f90123_256" type="1"><li class="list__item" id="24f90123_257"><p>USE DEDICATED FAST DISKS for the transaction log! (crucial for performance due to write-ahead-log, NVMe is preferred for heavy load setup).</p></li><li class="list__item" id="24f90123_258"><p>use 3 nodes (more nodes = slower quorum, less = no HA).</p></li><li class="list__item" id="24f90123_259"><p>low network latency between zookeeper nodes is very important (latency, not bandwidth).</p></li><li class="list__item" id="24f90123_260"><p>have at least 4Gb of RAM, disable swap, tune JVM sizes, and garbage collector settings.</p></li><li class="list__item" id="24f90123_261"><p>ensure that zookeeper will not be CPU-starved by some other processes</p></li><li class="list__item" id="24f90123_262"><p>monitor zookeeper.</p></li></ol><p id="24f90123_263">Side note: in many cases, the slowness of the zookeeper is actually a symptom of some issue with clickhouse schema/usage pattern (the most typical issues: an enormous number of partitions/tables/databases with real-time inserts, tiny &amp; frequent inserts).</p><p id="24f90123_264">Some doc about that subject:</p><ul class="list _ul" id="24f90123_265"><li class="list__item" id="24f90123_266"><p><a href="https://docs.confluent.io/platform/current/zookeeper/deployment.html" id="24f90123_267"   data-external="true" rel="noopener noreferrer" >https://docs.confluent.io/platform/current/zookeeper/deployment.html</a></p></li><li class="list__item" id="24f90123_268"><p><a href="https://zookeeper.apache.org/doc/r3.4.9/zookeeperAdmin.html#sc_commonProblems" id="24f90123_269"   data-external="true" rel="noopener noreferrer" >https://zookeeper.apache.org/doc/r3.4.9/zookeeperAdmin.html#sc_commonProblems</a></p></li><li class="list__item" id="24f90123_270"><p><a href="https://clickhouse.tech/docs/en/operations/tips/#zookeeper" id="24f90123_271"   data-external="true" rel="noopener noreferrer" >https://clickhouse.tech/docs/en/operations/tips/#zookeeper</a></p></li><li class="list__item" id="24f90123_272"><p><a href="https://lucene.apache.org/solr/guide/7_4/setting-up-an-external-zookeeper-ensemble.html" id="24f90123_273"   data-external="true" rel="noopener noreferrer" >https://lucene.apache.org/solr/guide/7_4/setting-up-an-external-zookeeper-ensemble.html</a></p></li><li class="list__item" id="24f90123_274"><p><a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/Troubleshooting" id="24f90123_275"   data-external="true" rel="noopener noreferrer" >https://cwiki.apache.org/confluence/display/ZOOKEEPER/Troubleshooting</a></p></li></ul><p id="24f90123_276">Cite from <a href="https://zookeeper.apache.org/doc/r3.5.7/zookeeperAdmin.html#sc_commonProblems" id="24f90123_277"   data-external="true" rel="noopener noreferrer" >https://zookeeper.apache.org/doc/r3.5.7/zookeeperAdmin.html#sc_commonProblems</a>:</p><aside class="prompt" data-type="tip" data-title="" id="24f90123_278"><section class="chapter"><h4 id="things-to-avoid" data-toc="things-to-avoid"   >Things to Avoid</h4><p id="24f90123_279">Here are some common problems you can avoid by configuring ZooKeeper correctly:</p><ul class="list _ul" id="24f90123_280"><li class="list__item" id="24f90123_281"><p><span class="emphasis" id="24f90123_282">inconsistent lists of servers</span>: The list of ZooKeeper servers used by the clients must match the list of ZooKeeper servers that each ZooKeeper server has. Things work okay if the client list is a subset of the real list, but things will really act strange if clients have a list of ZooKeeper servers that are in different ZooKeeper clusters. Also, the server lists in each Zookeeper server configuration file should be consistent with one another.</p></li><li class="list__item" id="24f90123_283"><p><span class="emphasis" id="24f90123_284">incorrect placement of transaction log</span>: The most performance critical part of ZooKeeper is the transaction log. ZooKeeper syncs transactions to media before it returns a response. A dedicated transaction log device is key to consistent good performance. Putting the log on a busy device will adversely affect performance. If you only have one storage device, increase the snapCount so that snapshot files are generated less often; it does not eliminate the problem, but it makes more resources available for the transaction log.</p></li><li class="list__item" id="24f90123_285"><p><span class="emphasis" id="24f90123_286">incorrect Java heap size</span>: You should take special care to set your Java max heap size correctly. In particular, you should not create a situation in which ZooKeeper swaps to disk. The disk is death to ZooKeeper. Everything is ordered, so if processing one request swaps the disk, all other queued requests will probably do the same. the disk. DON'T SWAP. Be conservative in your estimates: if you have 4G of RAM, do not set the Java max heap size to 6G or even 4G. For example, it is more likely you would use a 3G heap for a 4G machine, as the operating system and the cache also need memory. The best and only recommend practice for estimating the heap size your system needs is to run load tests, and then make sure you are well below the usage limit that would cause the system to swap.</p></li><li class="list__item" id="24f90123_287"><p><span class="emphasis" id="24f90123_288">Publicly accessible deployment</span>: A ZooKeeper ensemble is expected to operate in a trusted computing environment. It is thus recommended to deploy ZooKeeper behind a firewall.</p></li></ul></section></aside></section></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="kb-recovering-from-complete-metadata-loss-in-zookeeper.html">Recovering from complete metadata loss in ZooKeeper</a>   <a class="navigation-links__next" href="kb-how-to-check-the-list-of-watches.html">How to check the list of watches</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>