<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T22:54:22.1275528"><meta name="build-number" content="${buildNumber}">       <title>Engines | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"short-summary","level":0,"title":"Short summary","anchor":"#short-summary"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Engines | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/1.0/engines-engines-index.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Engines | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/1.0/engines-engines-index.html#webpage", "url": "/1.0/engines-engines-index.html", "name": "Engines | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="engines_engines_index" data-main-title="Engines" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///engines"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="engines_engines_index"   id="engines_engines_index.md">Engines</h1>  <p id="bf0c9df_530">#Engines linkTitle: &quot;Engines&quot; keywords:</p><ul class="list _ul" id="bf0c9df_531"><li class="list__item" id="bf0c9df_532"><p>clickhouse engine</p></li><li class="list__item" id="bf0c9df_533"><p>clickhouse mergetree description: &gt; Learn about ClickHouse engines, from MergeTree, Atomic Database to RocksDB. weight: 1</p></li></ul><p id="bf0c9df_535">Generally: the <span class="control" id="bf0c9df_536">main</span> engine in Clickhouse is called <a href="https://clickhouse.yandex/docs/en/table_engines/mergetree/" id="bf0c9df_537"   data-external="true" rel="noopener noreferrer" >MergeTree</a>. It allows to store and process data on one server and feel all the advantages of Clickhouse. Basic usage of MergeTree does not require any special configuration, and you can start using it 'out of the box'.</p><p id="bf0c9df_538">But one server and one copy of data are not fault-tolerant - something can happen with the server itself, with datacenter availability, etc. So you need to have the replica(s) - i.e. server(s) with the same data and which can 'substitute' the original server at any moment.</p><p id="bf0c9df_539">To have an extra copy (replica) of your data you need to use <a href="https://clickhouse.yandex/docs/en/table_engines/replication/" id="bf0c9df_540"   data-external="true" rel="noopener noreferrer" >ReplicatedMergeTree</a> engine. It can be used <span class="emphasis" id="bf0c9df_541">instead</span> of MergeTree engine, and you can always upgrade from MergeTree to ReplicatedMergeTree (and downgrade back) if you need. To use that you need to have ZooKeeper installed and running. For tests, you can use one standalone Zookeeper instance, but for production usage, you should have zookeeper ensemble at least of 3 servers.</p><p id="bf0c9df_542">When you use ReplicatedMergeTree then the inserted data is copied automatically to all the replicas, but all the SELECTs are executed on the single server you have connected to. So you can have 5 replicas of your data, but if you will always connect to one replica - it will not 'share' / 'balance' that traffic automatically between all the replicas, one server will be loaded and the rest will generally do nothing. If you need that balancing of load between multiple replicas - you can use the internal 'loadbalancer' mechanism which is provided by <a href="https://clickhouse.yandex/docs/en/table_engines/distributed/" id="bf0c9df_543"   data-external="true" rel="noopener noreferrer" >Distributed</a> engine of Clickhouse. As an alternative in that scenario you can work without Distributed table, but with some external load balancer that will balance the requests between several replicas according to your specific rules or preferences, or just cluster-aware client which will pick one of the servers for the query time.</p><p id="bf0c9df_544">The Distributed engine does not store any data, but it can 'point' to the same ReplicatedMergeTree/MergeTree table on multiple servers. To use Distributed engine you need to configure <code class="code" id="bf0c9df_545">&lt;cluser&gt;</code> settings in your ClickHouse server config file.</p><p id="bf0c9df_546">So let's say you have 3 replicas of table <code class="code" id="bf0c9df_547">my_replicated_data</code> with ReplicatedMergeTree engine. You can create a table with Distrtibuted engine called <code class="code" id="bf0c9df_548">my_distributed_replicated_data</code> which will 'point' to all of that 3 servers, and when you will select from that <code class="code" id="bf0c9df_549">my_distributed_replicated_data table</code> the select will be forwarded and executed on one of the replicas. So in that scenario, each replica will get 1/3 of requests (but each request still will be fully executed on one chosen replica).</p><p id="bf0c9df_550">All that is great, and will work well while one copy of your data is fitting on a single physical server, and can be processed by the resources of one server. When you have too much data to be stored/processed on one server - you need to use sharding (it's just a way to split the data into smaller parts). Sharding is the mechanism also provided by Distributed engine.</p><p id="bf0c9df_551">With sharding data is divided into parts (shards) according to some sharding key. You can just use random distribution, so let's say - throw a coin to decide on each of the servers the data should be stored, or you can use some 'smarter' sharding scheme, to make the data connected to the same subject (let's say to the same customer) stored on one server, and to another subject on another. So in that case all the shards should be requested at the same time and later the 'common' result should be calculated.</p><p id="bf0c9df_552">In ClickHouse each shard works independently and process its' part of data, inside each shard replication can work. And later to query all the shards at the same time and combine the final result - Distributed engine is used. So Distributed work as load balancer inside each shard, and can combine the data coming from different shards together to make the 'common' result.</p><p id="bf0c9df_553">You can use Distributed table for inserts, in that case, it will pass the data to one of the shards according to the sharding key. Or you can insert to the underlying table on one of the shards bypassing the Distributed table.</p><section class="chapter"><h2 id="short-summary" data-toc="short-summary"   >Short summary</h2><ol class="list _decimal" id="bf0c9df_554" type="1"><li class="list__item" id="bf0c9df_555"><p>start with MergeTree</p></li><li class="list__item" id="bf0c9df_556"><p>to have several copies of data use ReplicatedMergeTree</p></li><li class="list__item" id="bf0c9df_557"><p>if your data is too big to fit/ to process on one server - use sharding</p></li><li class="list__item" id="bf0c9df_558"><p>to balance the load between replicas and to combine the result of selects from different shards - use Distributed table.</p></li></ol><section class="chapter"><h3 id="more" data-toc="more"   >More</h3><p id="bf0c9df_559">Official tutorial clarify that a bit: <a href="https://clickhouse.yandex/tutorial.html" id="bf0c9df_560"   data-external="true" rel="noopener noreferrer" >https://clickhouse.yandex/tutorial.html</a></p><p id="bf0c9df_561">Please check also <a href="https://github.com/alex-zaitsev" id="bf0c9df_562"   data-external="true" rel="noopener noreferrer" >@alex-zaitsev</a> presentation, which also covers that subject: <a href="https://www.youtube.com/watch?v=zbjub8BQPyE" id="bf0c9df_563"   data-external="true" rel="noopener noreferrer" >https://www.youtube.com/watch?v=zbjub8BQPyE</a> ( Slides are here: <a href="https://yadi.sk/i/iLA5ssAv3NdYGy" id="bf0c9df_564"   data-external="true" rel="noopener noreferrer" >https://yadi.sk/i/iLA5ssAv3NdYGy</a>)</p><p id="bf0c9df_565">P.S. Actually you can create replication without Zookeeper and ReplicatedMergeTree, just by using the Distributed table above MergeTree and internal_replication=false cluster setting, but in that case, there will no guarantee that all the replicas will have 100% the same data, so I rather would not recommend that scenario.</p><p id="bf0c9df_566">[kb-atomic-database-engine/&quot; ]({{&lt;ref &quot;kb-atomic-database-engine/&quot; &gt;}})</p><p id="bf0c9df_567">[kb-embeddedrocksdb-and-dictionary.md&quot; ]({{&lt;ref &quot;kb-embeddedrocksdb-and-dictionary.md&quot; &gt;}})</p><p id="bf0c9df_568">[mergetree-table-engine-family/kb-nulls-in-order-by.md&quot; ]({{&lt;ref &quot;mergetree-table-engine-family/kb-nulls-in-order-by.md&quot; &gt;}})</p><p id="bf0c9df_569">[mergetree-table-engine-family/replacingmergetree/kb-replacingmergetree-does-not-collapse-duplicates.md&quot; ]({{&lt;ref &quot;mergetree-table-engine-family/replacingmergetree/kb-replacingmergetree-does-not-collapse-duplicates.md&quot; &gt;}})</p><p id="bf0c9df_570">Based on my original answer on github: <a href="https://github.com/ClickHouse/ClickHouse/issues/2161" id="bf0c9df_571"   data-external="true" rel="noopener noreferrer" >https://github.com/ClickHouse/ClickHouse/issues/2161</a></p></section></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="engines-kb-embeddedrocksdb-and-dictionary.html">EmbeddedRocksDB &amp; dictionary</a>   <a class="navigation-links__next" href="kb-how-to-convert-atomic-to-ordinary.html">How to Convert Atomic to Ordinary</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>