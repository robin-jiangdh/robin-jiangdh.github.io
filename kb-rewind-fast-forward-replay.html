<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-17T23:19:47.8249901"><meta name="build-number" content="${buildNumber}">       <title>Rewind / fast-forward / replay | blog</title><script id="virtual-toc-data" type="application/json">[{"id":"rewind-fast-forward-replay-linktitle-rewind-fast-forward-replay-description-rewind-fast-forward-replay","level":0,"title":"#Rewind / fast-forward / replay\nlinkTitle: \"Rewind / fast-forward / replay\"\ndescription: \u003e\nRewind / fast-forward / replay","anchor":"#rewind-fast-forward-replay-linktitle-rewind-fast-forward-replay-description-rewind-fast-forward-replay"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Rewind / fast-forward / replay | blog"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="blog Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/blog/1.0/kb-rewind-fast-forward-replay.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Rewind / fast-forward / replay | blog"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/blog/1.0/kb-rewind-fast-forward-replay.html#webpage", "url": "/blog/1.0/kb-rewind-fast-forward-replay.html", "name": "Rewind / fast-forward / replay | blog", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/blog/#website", "url": "/blog/", "name": "blog Help" }</script><!-- End Schema.org --></head>      <body data-id="kb-rewind-fast-forward-replay" data-main-title="Rewind / fast-forward / replay" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Clickhouse///kb-integrations///kb-kafka"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>blog 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="kb-rewind-fast-forward-replay"   id="kb-rewind-fast-forward-replay.md">Rewind / fast-forward / replay</h1>  <section class="chapter"><h2 id="rewind-fast-forward-replay-linktitle-rewind-fast-forward-replay-description-rewind-fast-forward-replay" data-toc="rewind-fast-forward-replay-linktitle-rewind-fast-forward-replay-description-rewind-fast-forward-replay"   >#Rewind / fast-forward / replay
linkTitle: &quot;Rewind / fast-forward / replay&quot;
description: &gt;
Rewind / fast-forward / replay</h2><ul class="list _ul" id="dabc21e3_190"><li class="list__item" id="dabc21e3_191"><p>Step 1: Detach Kafka tables in ClickHouse</p></li><li class="list__item" id="dabc21e3_192"><p>Step 2: <code class="code" id="dabc21e3_193">kafka-consumer-groups.sh --bootstrap-server kafka:9092 --topic topic:0,1,2 --group id1 --reset-offsets --to-latest --execute</code></p><ul class="list _ul" id="dabc21e3_194"><li class="list__item" id="dabc21e3_195"><p>More samples: <a href="https://gist.github.com/filimonov/1646259d18b911d7a1e8745d6411c0cc" id="dabc21e3_196"   data-external="true" rel="noopener noreferrer" >https://gist.github.com/filimonov/1646259d18b911d7a1e8745d6411c0cc</a></p></li></ul></li><li class="list__item" id="dabc21e3_197"><p>Step: Attach Kafka tables back</p></li></ul><p id="dabc21e3_198">See also these configuration settings:</p><div class="code-block" data-lang="markup"         >
&lt;kafka&gt;
  &lt;auto_offset_reset&gt;smallest&lt;/auto_offset_reset&gt;
&lt;/kafka&gt;
</div><section class="chapter"><h3 id="about-offset-consuming" data-toc="about-offset-consuming"   >About Offset Consuming</h3><p id="dabc21e3_200">When a consumer joins the consumer group, the broker will check if it has a commited offset. If that is the case, then it will start from the latest offset. Both ClickHouse and librdKafka documentation state that the default value for <code class="code" id="dabc21e3_201">auto_offset_reset</code> is largest (or <code class="code" id="dabc21e3_202">latest</code> in new Kafka versions) but it is not, if the consumer is new:</p><p id="dabc21e3_203">https://github.com/ClickHouse/ClickHouse/blob/f171ad93bcb903e636c9f38812b6aaf0ab045b04/src/Storages/Kafka/StorageKafka.cpp#L506</p><p id="dabc21e3_204">&nbsp;<code class="code" id="dabc21e3_205">conf.set(&quot;auto.offset.reset&quot;, &quot;earliest&quot;); &nbsp; &nbsp; // If no offset stored for this group, read all messages from the start</code></p><p id="dabc21e3_206">If there is no offset stored or it is out of range, for that particular consumer group, the consumer will start consuming from the beginning (<code class="code" id="dabc21e3_207">earliest</code>), and if there is some offset stored then it should use the <code class="code" id="dabc21e3_208">latest</code>. The log retention policy influences which offset values correspond to the <code class="code" id="dabc21e3_209">earliest</code> and <code class="code" id="dabc21e3_210">latest</code> configurations. Consider a scenario where a topic has a retention policy set to 1 hour. Initially, you produce 5 messages, and then, after an hour, you publish 5 more messages. In this case, the latest offset will remain unchanged from the previous example. However, due to Kafka removing the earlier messages, the earliest available offset will not be 0; instead, it will be 5.</p></section></section><div class="last-modified"> Last modified: 17 十二月 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="kb-selects-from-engine-kafka.html">SELECTs from engine=Kafka</a>   <a class="navigation-links__next" href="kb-kafka-index.html">Kafka</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>